<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shubham Gupta">
<meta name="dcterms.date" content="2025-09-01">
<meta name="description" content="Mapping ConvFinQA and crafting a curriculum for financial QA">

<title>Curriculum Learning ü§ù DSPy: Modelling ‚Äì Shubham Gupta</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<script src="../../site_libs/quarto-search/autocomplete-preset-algolia.umd.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-befe23ebd2f54d8af2c8a89d1a1611f1.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-d68be38d83eca2bb035acf846ffba811.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-3824aa816de5134366ccfe78104cf7a8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-d68be38d83eca2bb035acf846ffba811.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "algolia": {
    "application-id": "HR1HJNZUVY",
    "search-only-api-key": "3326e8971e20d27e2dd21591d6a24656",
    "index-name": "blog_pages",
    "index-fields": {
      "href": "url",
      "section": "sec",
      "text": "body"
    },
    "analytics-events": true,
    "show-logo": false,
    "libDir": "site_libs"
  },
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.5.1/dist/algoliasearch-lite.umd.js"></script>


<script type="text/javascript">
var ALGOLIA_INSIGHTS_SRC = "https://cdn.jsdelivr.net/npm/search-insights/dist/search-insights.iife.min.js";
!function(e,a,t,n,s,i,c){e.AlgoliaAnalyticsObject=s,e[s]=e[s]||function(){
(e[s].queue=e[s].queue||[]).push(arguments)},i=a.createElement(t),c=a.getElementsByTagName(t)[0],
i.async=1,i.src=n,c.parentNode.insertBefore(i,c)
}(window,document,"script",ALGOLIA_INSIGHTS_SRC,"aa");
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-plugin-algolia-insights">

</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CLKTGRWBQT"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CLKTGRWBQT', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Curriculum Learning ü§ù DSPy: Modelling ‚Äì Shubham Gupta">
<meta property="og:description" content="Mapping ConvFinQA and crafting a curriculum for financial QA">
<meta property="og:image" content="https://shubhamg.in/posts/cl_dspy/submission_mlflow_traces.png">
<meta property="og:site_name" content="Shubham Gupta">
<meta property="og:image:height" content="1880">
<meta property="og:image:width" content="3836">
<meta name="twitter:title" content="Curriculum Learning ü§ù DSPy: Modelling ‚Äì Shubham Gupta">
<meta name="twitter:description" content="Mapping ConvFinQA and crafting a curriculum for financial QA">
<meta name="twitter:image" content="https://shubhamg.in/posts/cl_dspy/submission_mlflow_traces.png">
<meta name="twitter:creator" content="@shubhamg2208">
<meta name="twitter:image-height" content="1880">
<meta name="twitter:image-width" content="3836">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Shubham Gupta</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/goodhamgupta"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Curriculum Learning ü§ù DSPy: Modelling</h1>
                  <div>
        <div class="description">
          Mapping ConvFinQA and crafting a curriculum for financial QA
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">programming</div>
                <div class="quarto-category">dspy</div>
                <div class="quarto-category">curriculum-learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Shubham Gupta </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 1, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#from-prompting-to-programming" id="toc-from-prompting-to-programming" class="nav-link active" data-scroll-target="#from-prompting-to-programming">From Prompting to Programming</a></li>
  <li><a href="#evaluation-metrics" id="toc-evaluation-metrics" class="nav-link" data-scroll-target="#evaluation-metrics">Evaluation Metrics</a>
  <ul class="collapse">
  <li><a href="#primary-metric-turn-level-em" id="toc-primary-metric-turn-level-em" class="nav-link" data-scroll-target="#primary-metric-turn-level-em">Primary Metric: Turn-level EM</a></li>
  <li><a href="#additional-metrics-future-work" id="toc-additional-metrics-future-work" class="nav-link" data-scroll-target="#additional-metrics-future-work">Additional Metrics (Future Work)</a></li>
  </ul></li>
  <li><a href="#model-list" id="toc-model-list" class="nav-link" data-scroll-target="#model-list">Model List</a>
  <ul class="collapse">
  <li><a href="#two-stage-gating-protocol" id="toc-two-stage-gating-protocol" class="nav-link" data-scroll-target="#two-stage-gating-protocol">Two-Stage Gating Protocol</a></li>
  <li><a href="#experiment-tracking" id="toc-experiment-tracking" class="nav-link" data-scroll-target="#experiment-tracking">Experiment Tracking</a></li>
  </ul></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection">Model Selection</a>
  <ul class="collapse">
  <li><a href="#gate-dataset-results" id="toc-gate-dataset-results" class="nav-link" data-scroll-target="#gate-dataset-results">Gate Dataset Results</a></li>
  <li><a href="#probe-dataset-results" id="toc-probe-dataset-results" class="nav-link" data-scroll-target="#probe-dataset-results">Probe Dataset Results</a></li>
  <li><a href="#error-analysis" id="toc-error-analysis" class="nav-link" data-scroll-target="#error-analysis">Error Analysis</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/goodhamgupta/personal_blog/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<p>In our <a href="../../posts/2025-08-31-cl-dspy-eda.html">previous exploration</a>, we analyzed 3,458 ConvFinQA records and established a curriculum learning framework with three difficulty stages: <strong>Easy</strong> (‚â§2 ops, simple context), <strong>Medium</strong> (2-3 ops, moderate complexity), and <strong>Hard</strong> (‚â•4 ops, complex multi-turn reasoning).</p>
<p>Now it‚Äôs time to put this curriculum to work by implementing and evaluating our models.</p>
<section id="from-prompting-to-programming" class="level2">
<h2 class="anchored" data-anchor-id="from-prompting-to-programming">From Prompting to Programming</h2>
<p>Traditionally, LLM applications rely on hand-rolled prompts‚Äîcarefully crafted text instructions that are often brittle and difficult to optimize, especially for complex multi-step reasoning tasks like financial QA.</p>
<p>Our curriculum learning approach demands systematic experimentation across models, difficulty levels, and optimization strategies. This makes DSPy the ideal framework, as it transforms prompting from an art into systematic, testable code.</p>
<p><strong>Why DSPy for curriculum learning?</strong></p>
<ul>
<li><strong>Reproducible experiments</strong>: Prompts become Python objects ‚Üí diffable, unit-testable, version-controlled</li>
<li><strong>Optimization</strong>: Built-in optimizers (LabeledFewShot, BootstrapFewShot) auto-search the prompt space across our curriculum stages</li>
<li><strong>Clean evaluation pipeline</strong>: First-class metrics support‚Äîplug in exact match, hit .compile(), get train/val loops with curriculum-aware sampling</li>
<li><strong>Model flexibility</strong>: Test curriculum effects across GPT-4, o4-mini, Gemini, and open-source models with one-line swaps</li>
<li><strong>Efficient iteration</strong>: Caching and threading speed up development cycles crucial for curriculum experiments</li>
</ul>
<p>This approach lets us test whether our Easy‚ÜíMedium‚ÜíHard curriculum improves financial reasoning compared to random sampling.</p>
</section>
<section id="evaluation-metrics" class="level2">
<h2 class="anchored" data-anchor-id="evaluation-metrics">Evaluation Metrics</h2>
<p>For this exploratory analysis, we need a clear metric to measure model performance across our curriculum learning experiments. Following the original ConvFinQA paper, we adopt <strong>Exact Match (EM)</strong> as our primary evaluation metric.</p>
<section id="primary-metric-turn-level-em" class="level3">
<h3 class="anchored" data-anchor-id="primary-metric-turn-level-em">Primary Metric: Turn-level EM</h3>
<p><strong>Turn-level EM</strong> measures whether the generated answer for a specific dialogue turn exactly matches the gold standard answer. This binary metric (1 for exact match, 0 otherwise) provides a strict but interpretable measure of performance that directly aligns with the task requirements.</p>
<p>We choose this as our primary metric for several reasons: - <strong>Simplicity</strong>: Easy to implement and interpret for initial experimentation - <strong>Strictness</strong>: Financial reasoning requires precision‚Äîapproximate answers can be misleading - <strong>Comparability</strong>: Direct comparison with baseline results from the original paper - <strong>Curriculum sensitivity</strong>: Clear signal for measuring improvement across difficulty levels</p>
</section>
<section id="additional-metrics-future-work" class="level3">
<h3 class="anchored" data-anchor-id="additional-metrics-future-work">Additional Metrics (Future Work)</h3>
<p>There are several other metrics could be useful:</p>
<p><strong>Conversation-level metrics</strong> like Dialogue Mean EM and Joint EM would better capture multi-turn reasoning dependencies, but add complexity to curriculum design. Since our curriculum is based on individual example difficulty rather than conversation-level complexity, turn-level metrics are more appropriate for this phase.</p>
<p><strong>Diagnostic metrics</strong> such as Exec-agree % and numeric error analysis would help distinguish between reasoning failures and execution errors. However, for establishing whether curriculum learning improves over random sampling, the binary success signal from exact match provides sufficient discriminative power.</p>
<p><strong>Efficiency metrics</strong> like program length and evidence tokens could reveal interesting patterns about how curriculum learning affects model behavior, but are secondary to establishing basic performance improvements.</p>
<p>We‚Äôve skipped the other metrics for now for the sake of brevity.</p>
</section>
</section>
<section id="model-list" class="level2">
<h2 class="anchored" data-anchor-id="model-list">Model List</h2>
<p>We will consider the following <em>families</em> of models:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 25%">
<col style="width: 56%">
</colgroup>
<thead>
<tr class="header">
<th>Family</th>
<th>Rationale</th>
<th>Benchmarked Checkpoints</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Non-Reasoning</strong></td>
<td>Classic next-token predictors. Useful as baselines for curriculum-learning because they expose the value of explicit reasoning.</td>
<td>‚Ä¢ <code>openai/gpt-4.1-2025-04-14</code> <br>‚Ä¢ <code>openai/gpt-4.1-mini-2025-04-14</code></td>
</tr>
<tr class="even">
<td><strong>Reasoning</strong></td>
<td>Architected for multi-step, chain-of-thought inference. Expected to excel once the curriculum introduces compositional tasks.</td>
<td>‚Ä¢ <code>openai/o4-mini-2025-04-16</code> <br>‚Ä¢ <code>anthropic/claude-sonnet-4-20250514</code> <br>‚Ä¢ <code>gemini-2.5-flash</code> <br>‚Ä¢ <code>gemini-2.5-flash-lite</code></td>
</tr>
<tr class="odd">
<td><strong>Frontier</strong></td>
<td>Flagship models from frontier labs. Highest quality but costly‚Äîkept only for upper-bound comparisons, not final deployment.</td>
<td>‚Ä¢ <code>openai/o3-2025-04-16</code> <br>‚Ä¢ <code>anthropic/claude-opus-4-20250514</code> <br>‚Ä¢ <code>gemini-2.5-pro</code></td>
</tr>
<tr class="even">
<td><strong>Open-Source</strong></td>
<td>Critical for cost-sensitive deployments(an OS models FTW). Benchmarked to quantify the closed‚Äìopen gap.</td>
<td>‚Ä¢ <code>qwen3-32b</code></td>
</tr>
</tbody>
</table>
<section id="two-stage-gating-protocol" class="level3">
<h3 class="anchored" data-anchor-id="two-stage-gating-protocol">Two-Stage Gating Protocol</h3>
<ol type="1">
<li><p><strong>Gate</strong><br>
‚Ä¢ Dataset: 50 ‚ÄúEasy‚Äù teacher-forced dialogues<br>
‚Ä¢ Retain a model only if <strong>Turn-EM ‚â• 0.55</strong></p></li>
<li><p><strong>Probe</strong><br>
‚Ä¢ Dataset: 30 dialogues (15 Medium + 15 Hard), closed-loop<br>
‚Ä¢ Retain a model only if <strong>Final-Turn EM ‚â• 0.35</strong> <em>and</em> <strong>Dialogue-mean EM ‚â• 0.35</strong></p></li>
</ol>
<p>This pipeline quickly eliminates weak candidates while preserving models whose strengths surface in longer, reasoning-heavy contexts.</p>
</section>
<section id="experiment-tracking" class="level3">
<h3 class="anchored" data-anchor-id="experiment-tracking">Experiment Tracking</h3>
<p>All training and evaluation runs are logged with <strong>MLflow</strong>:</p>
<ul>
<li>MLflow Tracking ‚Äì run metadata, metrics, and artifacts for DSPy experiments<br>
</li>
<li>MLflow Model ‚Äì package DSPy programs for reproducible rollout<br>
</li>
<li>MLflow Evaluate ‚Äì built-in GenAI evaluators for rapid iteration<br>
</li>
<li>MLflow Tracing ‚Äì one-line capture of DSPy internals for debugging</li>
</ul>
<p>In production, the deployment pipeline would look as follows:</p>
<p align="center">
, <img src="../cl_dspy/mlflow_dspy.png" alt="DSPy Production deployment with MLFlow. Source: DSPy Docs" width="200" height="300">, <br>, <sub>, DSPy Production deployment with MLFlow. Source: <a href="https://mlflow.org/docs/latest/genai/flavors/dspy/">MLFlow Docs</a>, </sub>,
</p>
</section>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mlflow</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> IFrame, HTML, display</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>mlflow.set_tracking_uri(<span class="st">"http://localhost:5000"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>mlflow.dspy.autolog(log_compiles<span class="op">=</span><span class="va">True</span>, log_evals<span class="op">=</span><span class="va">True</span>, log_traces_from_compile<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> mlflow.set_experiment(<span class="st">"DSPy"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display MLFlow UI in an iframe to prevent HTML document conflicts</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Experiment: </span><span class="sc">{</span>result<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> (ID: </span><span class="sc">{</span>result<span class="sc">.</span>experiment_id<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>display(HTML(<span class="ss">f'&lt;p&gt;&lt;a href="http://localhost:5000/#/experiments/</span><span class="sc">{</span>result<span class="sc">.</span>experiment_id<span class="sc">}</span><span class="ss">" target="_blank"&gt;View MLFlow Experiment UI&lt;/a&gt;&lt;/p&gt;'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>&lt;Experiment: artifact_location='mlflow-artifacts:/1', creation_time=1753611058221, experiment_id='1', last_update_time=1753611058221, lifecycle_stage='active', name='DSPy', tags={}&gt;</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dotenv</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dspy</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>dotenv.load_dotenv(<span class="st">"../.env"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>MAX_TOKENS <span class="op">=</span> <span class="dv">20_000</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>lm_oai_gpt_4_1 <span class="op">=</span> dspy.LM(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"openai/gpt-4.1-2025-04-14"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.environ[<span class="st">"OPENAI_API_KEY"</span>],</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>MAX_TOKENS,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>lm_oai_gpt_4_1_mini <span class="op">=</span> dspy.LM(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"openai/gpt-4.1-mini-2025-04-14"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.environ[<span class="st">"OPENAI_API_KEY"</span>],</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>MAX_TOKENS,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>lm_oai_o4_mini <span class="op">=</span> dspy.LM(</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"openai/o4-mini-2025-04-16"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.environ[<span class="st">"OPENAI_API_KEY"</span>],</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    temperature<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>MAX_TOKENS,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>lm_anthropic_sonnet_4_0 <span class="op">=</span> dspy.LM(</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"anthropic/claude-sonnet-4-20250514"</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.environ[<span class="st">"ANTHROPIC_API_KEY"</span>],</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>MAX_TOKENS,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>lm_gemini_flash_2_5 <span class="op">=</span> dspy.LM(</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gemini/gemini-2.5-flash"</span>,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.environ[<span class="st">"GEMINI_API_KEY"</span>],</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>MAX_TOKENS,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>lm_gemini_flash_2_5_lite <span class="op">=</span> dspy.LM(</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gemini/gemini-2.5-flash-lite"</span>,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.environ[<span class="st">"GEMINI_API_KEY"</span>],</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>MAX_TOKENS,</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>lm_oai_o3 <span class="op">=</span> dspy.LM(</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"openai/o3-2025-04-16"</span>,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.environ[<span class="st">"OPENAI_API_KEY"</span>],</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    temperature<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>MAX_TOKENS,</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>lm_anthropic_opus_4_0 <span class="op">=</span> dspy.LM(</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"anthropic/claude-opus-4-20250514"</span>,</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.environ[<span class="st">"ANTHROPIC_API_KEY"</span>],</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>MAX_TOKENS,</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>lm_gemini_pro_2_5 <span class="op">=</span> dspy.LM(</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gemini/gemini-2.5-pro"</span>,</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.environ[<span class="st">"GEMINI_API_KEY"</span>],</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>MAX_TOKENS,</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>lm_qwen3_32b <span class="op">=</span> dspy.LM(</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ollama/qwen3:32b"</span>,</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    api_base<span class="op">=</span><span class="st">"http://localhost:11434"</span>,</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span>MAX_TOKENS,</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dspy</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>llms <span class="op">=</span> [</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    lm_oai_gpt_4_1,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    lm_oai_gpt_4_1_mini,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    lm_oai_o4_mini,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    lm_anthropic_sonnet_4_0,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    lm_gemini_flash_2_5,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    lm_gemini_flash_2_5_lite,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    lm_oai_o3,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    lm_anthropic_opus_4_0,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    lm_gemini_pro_2_5,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    lm_qwen3_32b,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Echo(dspy.Signature):</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Echoes the input prompt."""</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> dspy.InputField()</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> dspy.OutputField()</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> mlflow.start_run(run_name<span class="op">=</span><span class="st">"Setup"</span>) <span class="im">as</span> run:</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> lm <span class="kw">in</span> llms:</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> dspy.context(lm<span class="op">=</span>lm, track_usage<span class="op">=</span><span class="va">True</span>, cache<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> lm <span class="kw">in</span> [lm_oai_gpt_4_1, lm_oai_gpt_4_1_mini]:</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                    program <span class="op">=</span> dspy.Predict(<span class="st">"instruction -&gt; answer"</span>)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                    program <span class="op">=</span> dspy.ChainOfThought(<span class="st">"instruction -&gt; answer"</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                response <span class="op">=</span> program(instruction<span class="op">=</span><span class="st">"What is the date?"</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">getattr</span>(response, <span class="st">"reasoning"</span>, <span class="va">None</span>):</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>lm<span class="sc">.</span>model<span class="sc">}</span><span class="ss"> Reasoning: </span><span class="sc">{</span>response<span class="sc">.</span>reasoning<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>lm<span class="sc">.</span>model<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>response<span class="sc">.</span>answer<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="bu">getattr</span>(lm, <span class="st">'model'</span>, lm)<span class="sc">}</span><span class="ss">: ERROR - </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>openai/gpt-4.1-2025-04-14: Today's date is June 13, 2024.
openai/gpt-4.1-mini-2025-04-14: The current date is June 15, 2024.
openai/o4-mini-2025-04-16 Reasoning: The user asked for the current date. I will provide today's date in a clear, human-readable format.
openai/o4-mini-2025-04-16: The current date is May 30, 2024.
anthropic/claude-sonnet-4-20250514 Reasoning: The user is asking for the current date. However, I don't have access to real-time information or the ability to know what the current date is. I should explain that I cannot provide the current date and suggest how they can find this information.
anthropic/claude-sonnet-4-20250514: I don't have access to real-time information, so I cannot tell you the current date. To find today's date, you can:
- Check your computer, phone, or other device
- Search "what is today's date" in a search engine
- Ask a voice assistant like Siri, Alexa, or Google Assistant
gemini/gemini-2.5-flash Reasoning: The user is asking for the current date. I will provide today's date.
gemini/gemini-2.5-flash: June 10, 2024
gemini/gemini-2.5-flash-lite Reasoning: The user is asking for the current date. I need to access the current date and format it as requested.
gemini/gemini-2.5-flash-lite: The current date is October 26, 2023.
openai/o3-2025-04-16 Reasoning: I don‚Äôt have real-time access to the system clock, so I‚Äôm unable to determine the exact current date at the moment of this response.
openai/o3-2025-04-16: I‚Äôm sorry, I don‚Äôt have access to real-time information to tell today‚Äôs date.
anthropic/claude-opus-4-20250514 Reasoning: The user is asking for the current date. However, as an AI assistant, I don't have access to real-time information and cannot provide the current date. I should explain this limitation clearly to the user.
anthropic/claude-opus-4-20250514: I don't have access to real-time information, so I cannot tell you today's date. To get the current date, you can check your device's calendar, search "what's today's date" in a search engine, or ask a voice assistant with real-time capabilities.
gemini/gemini-2.5-pro Reasoning: The user has asked for the current date. I will access my internal system's real-time clock to provide the current calendar date.
gemini/gemini-2.5-pro: Today's date is September 10, 2024.
ollama/qwen3:32b Reasoning: I cannot access real-time data or the current date. My knowledge is static and up to July 2024. To find the current date, please check your device's clock or calendar.
ollama/qwen3:32b: I cannot provide the current date as I do not have access to real-time information. Please check your device's clock or calendar for the current date.
üèÉ View run Setup at: http://localhost:5000/#/experiments/1/runs/20df48ca1ad2461d9dcc0b1575caec6d
üß™ View experiment at: http://localhost:5000/#/experiments/1</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>
  <style scoped="">
  button {
    border: none;
    border-radius: 4px;
    background-color: rgb(34, 114, 180);
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial;
    font-size: 13px;
    color: white;
    margin-top: 8px;
    margin-bottom: 8px;
    padding: 8px 16px;
    cursor: pointer;
  }
  button:hover {
    background-color: rgb(66, 153, 224);
  }
  </style>
  <button onclick="
        const display = this.nextElementSibling.style.display;
        const isCollapsed = display === 'none';
        this.nextElementSibling.style.display = isCollapsed ? null : 'none';

        const verb = isCollapsed ? 'Collapse' : 'Expand';
        this.innerText = `${verb} MLflow Trace`;
    ">Collapse MLflow Trace</button>
  <iframe id="trace-renderer" style="width: 100%; height: 500px; border: none; resize: vertical;" src="http://localhost:5000/static-files/lib/notebook-trace-renderer/index.html?trace_id=3be570b5035f48159f5f6f8b102b3565&amp;experiment_id=1&amp;trace_id=5ef345c76c844b5786e8d8d54b9de2c6&amp;experiment_id=1&amp;trace_id=9e5a6b35374a4fbc8cbc10bcf48a9765&amp;experiment_id=1&amp;trace_id=f54a2f585a8248feb6f8b0e56b6821ca&amp;experiment_id=1&amp;trace_id=7d0291783ca34ac3a2304daa01790993&amp;experiment_id=1&amp;trace_id=7d7c7c7e1e534a6abdcba8718079d6e1&amp;experiment_id=1&amp;trace_id=0a13673c74a146c4b6fdbfde935a0390&amp;experiment_id=1&amp;trace_id=0e3ebc3c4d1d4d4e8b2cef92e92d608a&amp;experiment_id=1&amp;trace_id=c5866268627d4319a05eb6af34b78672&amp;experiment_id=1&amp;trace_id=1f253b525ef547649472ffd87573560d&amp;experiment_id=1&amp;version=3.1.4">
</div>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="11">
<div class="sourceCode" id="cb6"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> json.load(<span class="bu">open</span>(<span class="st">&quot;../data/convfinqa_dataset.json&quot;</span>))</span></code></pre></div>
</div>
</section>
<section id="model-selection" class="level2">
<h2>Model Selection</h2>
<p>In the <strong>easy</strong> problems stage, we will select a relatively straightforward implementation. Specifically, we will provide the model with all context, and ask it to answer the question in a zero-shot manner.</p>
<p>This will help us identify strong baseline performance, and identify any issues with the model‚Äôs ability to understand the problem.</p>
<p>First, we will create the DSPy signatures for our dataset. Signatures are used to define the input and output of a model.</p>
<p>Specifically, we will have two types of signatures: one that doesn‚Äôt support reasoning model(for direct prediction models like GPT-4.1), and one that does support reasoning mode(for the reasoning models like o3, gemini pro, etc.)</p>
<div id="cell-13" class="cell" data-execution_count="260">
<div class="sourceCode" id="cb7"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SolveTurnWithoutReasoning(dspy.Signature):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    conversation_context: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(desc<span class="op">=</span><span class="st">&quot;Conversation so far&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    evidence_snippets: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Snippets of evidence surrounding the table&quot;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    table: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(desc<span class="op">=</span><span class="st">&quot;Input financial table with metrics&quot;</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    question: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(desc<span class="op">=</span><span class="st">&quot;Question to answer&quot;</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    ops: <span class="bu">str</span> <span class="op">=</span> dspy.OutputField(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Comma-separated ConvFinQA DSL program. Allowed ops: add(x, y), subtract(x, y), multiply(x, y), divide(x, y), exp(x, y), greater(x, y). Args may be constants (e.g., const_100), numbers (int or float), or prior step refs (#0, #1‚Ä¶). Order always follows the pattern x &lt;op&gt; y‚Äîpick x and y deliberately. Example: subtract(const_100, 42), divide(#0, 3.14). Convert to percentages only if explicitly asked in the question.&quot;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    answer: <span class="bu">str</span> <span class="op">=</span> dspy.OutputField(</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Final answer. This will be a single number, or a boolean string(yes/no)&quot;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SolveTurnWithReasoning(dspy.Signature):</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    conversation_context: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(desc<span class="op">=</span><span class="st">&quot;Conversation so far&quot;</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    evidence_snippets: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Snippets of evidence surrounding the table&quot;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    table: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(desc<span class="op">=</span><span class="st">&quot;Input financial table with metrics&quot;</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    question: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(desc<span class="op">=</span><span class="st">&quot;Question to answer&quot;</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    reasoning: <span class="bu">str</span> <span class="op">=</span> dspy.OutputField(</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Reasoning behind the answer. Carefully analyze the conversation_context, and especially the evidence_snippets and table for the given question, and generate your reasoning before generating the ops and answer.&quot;</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    ops: <span class="bu">str</span> <span class="op">=</span> dspy.OutputField(</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Comma-separated ConvFinQA DSL program. Allowed ops: add(x, y), subtract(x, y), multiply(x, y), divide(x, y), exp(x, y), greater(x, y). Args may be constants (e.g., const_100), numbers (int or float), or prior step refs (#0, #1‚Ä¶). Order always follows the pattern x &lt;op&gt; y‚Äîpick x and y deliberately. Example: subtract(const_100, 42), divide(#0, 3.14). Convert to percentages only if explicitly asked in the question.&quot;</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    answer: <span class="bu">str</span> <span class="op">=</span> dspy.OutputField(</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Final answer. This will be a single number, or a boolean string(yes/no)&quot;</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TurnSolver(dspy.Module):</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">    In the context of this series of interconnected finance-related queries and the additional information provided by the pretext, table data, and posttext from a company&#39;s financial filings, please provide a response to the final question. This may require extracting information from the context and performing mathematical calculations. Please take into account the information provided in the preceding questions and their answers when formulating your response: </span><span class="ch">\n\n</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, reasoning_lm<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> reasoning_lm:</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.pred <span class="op">=</span> dspy.ChainOfThought(SolveTurnWithReasoning)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.pred <span class="op">=</span> dspy.Predict(SolveTurnWithoutReasoning)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, conversation_context, evidence_snippets, table, question):</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co">        Run the model to solve a single turn.</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="co">            conversation_context (str): Conversation so far.</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="co">            evidence_snippets (str): Evidence text around the table.</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="co">            table (str): Financial table in markdown.</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="co">            question (str): Question to answer.</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="co">            dspy.Prediction: Model output with reasoning, ops, and answer.</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.pred(</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>            conversation_context<span class="op">=</span>conversation_context,</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>            evidence_snippets<span class="op">=</span>evidence_snippets,</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>            table<span class="op">=</span>table,</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>            question<span class="op">=</span>question,</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
</div>
<p>Next, we define a few helper functions to format our dataset for the DSPy model. We intentionally don‚Äôt spend too much time here for now, and will come back to this later, during the <em>optimization</em> phase.</p>
<div id="cell-15" class="cell" data-execution_count="405">
<div class="sourceCode" id="cb8"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> norm_ans(x):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Normalize an answer for comparison.</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Converts input to string, strips whitespace, removes percent signs,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">    and attempts to cast to float. If conversion fails, returns the cleaned string.</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">        x: The answer to normalize (str, float, or int).</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">        float or str: Normalized float if possible, else cleaned string.</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="bu">str</span>(x).strip().replace(<span class="st">&quot;%&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">float</span>(s)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> s</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _table_md(table_dict: <span class="bu">dict</span>, max_cols: <span class="bu">int</span> <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Convert a dictionarised table to compact GitHub-markdown.</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co">    Accepted shapes</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co">    1) {row_name: {col_name: value, ‚Ä¶}, ‚Ä¶}   # regular 2-level mapping</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">    2) {col_name: value, ‚Ä¶}                  # flat ‚Üí coerced to single row</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Guarantees</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co">    ‚Ä¢ Original row order is kept.</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co">    ‚Ä¢ Column headers are kept in *first-seen* order; NO deduplication.</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co">    ‚Ä¢ max_cols (if given) truncates *after* enumeration, duplicates included.</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co">    ‚Ä¢ None ‚Üí &quot;&quot; and everything else is str()-ed.</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> table_dict:</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">all</span>(<span class="kw">not</span> <span class="bu">isinstance</span>(v, <span class="bu">dict</span>) <span class="cf">for</span> v <span class="kw">in</span> table_dict.values()):</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># flat mapping ‚Üí one anonymous row</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        table_dict <span class="op">=</span> {<span class="st">&quot;&quot;</span>: <span class="bu">dict</span>(table_dict)}</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ensure every value is a dict</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>        table_dict <span class="op">=</span> {</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>            r: (v <span class="cf">if</span> <span class="bu">isinstance</span>(v, <span class="bu">dict</span>) <span class="cf">else</span> {<span class="st">&quot;&quot;</span>: v}) <span class="cf">for</span> r, v <span class="kw">in</span> table_dict.items()</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    row_ids <span class="op">=</span> <span class="bu">list</span>(table_dict.keys())  <span class="co"># preserve caller order</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    cols: <span class="bu">list</span> <span class="op">=</span> []</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> row_ids:</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        cols.extend(table_dict[r].keys())</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> max_cols <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        cols <span class="op">=</span> cols[:max_cols]</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    header <span class="op">=</span> <span class="st">&quot;| Row | &quot;</span> <span class="op">+</span> <span class="st">&quot; | &quot;</span>.join(<span class="bu">map</span>(<span class="bu">str</span>, cols)) <span class="op">+</span> <span class="st">&quot; |&quot;</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    sep <span class="op">=</span> <span class="st">&quot;|&quot;</span> <span class="op">+</span> <span class="st">&quot;---|&quot;</span> <span class="op">*</span> (<span class="bu">len</span>(cols) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> [header, sep]</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> row_ids:</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        vals <span class="op">=</span> [<span class="bu">str</span>(table_dict[r].get(c, <span class="st">&quot;&quot;</span>)) <span class="cf">for</span> c <span class="kw">in</span> cols]</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>        lines.append(<span class="st">&quot;| &quot;</span> <span class="op">+</span> <span class="bu">str</span>(r) <span class="op">+</span> <span class="st">&quot; | &quot;</span> <span class="op">+</span> <span class="st">&quot; | &quot;</span>.join(vals) <span class="op">+</span> <span class="st">&quot; |&quot;</span>)</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(lines)</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_inputs_from_row(</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    row,</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>    turn_idx,</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>,</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    history_mode: <span class="bu">str</span> <span class="op">=</span> <span class="st">&quot;teacher&quot;</span>,</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    state: <span class="bu">dict</span> <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>    max_table_cols: <span class="bu">int</span> <span class="op">=</span> <span class="dv">100</span>,</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="co">    history_mode: &#39;teacher&#39; | &#39;model&#39; | &#39;none&#39;</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="co">    state: carries model predictions across turns when history_mode=&#39;model&#39;</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="co">           expected keys: {&#39;pred_answers&#39;: list[str|float]}</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="co">    evidence_builder: optional callable(row, turn_idx)-&gt;str; if None, use simple truncation.</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>    qs <span class="op">=</span> row[<span class="st">&quot;dialogue_conv_questions&quot;</span>]</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    gold <span class="op">=</span> row[<span class="st">&quot;dialogue_executed_answers&quot;</span>]</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---- history ----</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    history_lines <span class="op">=</span> []</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(turn_idx):</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>        history_lines.append(<span class="ss">f&quot;Q</span><span class="sc">{</span>t <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>qs[t]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> history_mode <span class="op">==</span> <span class="st">&quot;teacher&quot;</span>:</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>            history_lines.append(<span class="ss">f&quot;A</span><span class="sc">{</span>t <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>gold[t]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> (</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>            history_mode <span class="op">==</span> <span class="st">&quot;model&quot;</span> <span class="kw">and</span> state <span class="kw">and</span> <span class="bu">len</span>(state.get(<span class="st">&quot;pred_answers&quot;</span>, [])) <span class="op">&gt;</span> t</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>        ):</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>            history_lines.append(<span class="ss">f&quot;A</span><span class="sc">{</span>t <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>state[<span class="st">&#39;pred_answers&#39;</span>][t]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> history_mode <span class="op">==</span> <span class="st">&quot;none&quot;</span>:</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span>  <span class="co"># only questions</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>    conversation_context <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(history_lines) <span class="cf">if</span> history_lines <span class="cf">else</span> <span class="st">&quot;None&quot;</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compact pre/post: first N sentences</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># def first_sents(txt, n):</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     if not txt: return &quot;&quot;</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     # very light sentence split</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     parts = [p.strip() for p in txt.split(&quot;. &quot;) if p.strip()]</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     return &quot;. &quot;.join(parts[:n])</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pre = first_sents(row.get(&quot;doc_pre_text&quot;, &quot;&quot;) or &quot;&quot;, max_pre_sents)</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># post= first_sents(row.get(&quot;doc_post_text&quot;, &quot;&quot;) or &quot;&quot;, max_post_sents)</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># evidence_snippets = f&quot;[PRE]\n{pre}\n[/PRE]\n[POST]\n{post}\n[/POST]&quot;</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>    evidence_snippets <span class="op">=</span> (</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f&quot;[PRE]</span><span class="ch">\n</span><span class="sc">{</span>row[<span class="st">&#39;doc_pre_text&#39;</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">[/PRE]</span><span class="ch">\n</span><span class="ss">[POST]</span><span class="ch">\n</span><span class="sc">{</span>row[<span class="st">&#39;doc_post_text&#39;</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">[/POST]&quot;</span></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>    table_md <span class="op">=</span> _table_md(row.get(<span class="st">&quot;doc_table&quot;</span>, {}) <span class="kw">or</span> {}, max_cols<span class="op">=</span>max_table_cols)</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">dict</span>(</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>        conversation_context<span class="op">=</span>conversation_context,</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>        evidence_snippets<span class="op">=</span>evidence_snippets,</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>        table<span class="op">=</span>table_md,</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>        question<span class="op">=</span>qs[turn_idx],</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>        <span class="op">**</span>row,</span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
</div>
<div id="cell-16" class="cell" data-execution_count="406">
<div class="sourceCode" id="cb9"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_dialogues(model, df):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Evaluate a dialogue model on a DataFrame of conversations.</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">        model: Callable that takes unpacked input dict and returns an object with at least `.answer` (and optionally `.ops`).</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">        df: pd.DataFrame with columns:</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">            - &quot;dialogue_conv_questions&quot;: list of str, all questions in the conversation</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">            - &quot;dialogue_executed_answers&quot;: list of str/float, all executed answers so far</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">            - (other columns as needed by evidence_builder)</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">        dict with:</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">            - &quot;turn_em_micro&quot;: float, micro-averaged exact match over all turns</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">            - &quot;dlg_mean_em_macro&quot;: float, macro-averaged mean EM per dialogue</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">            - &quot;joint_em&quot;: float, fraction of dialogues with all turns correct</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">            - &quot;final_turn_em&quot;: float, EM on the final turn of each dialogue</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">            - &quot;n_dialogues&quot;: int, number of dialogues</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">            - &quot;n_turns&quot;: int, total number of turns</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    turn_hits <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    turn_tot <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec_hits = 0</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    dlg_mean_ems <span class="op">=</span> []</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    dlg_joint_hits <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    final_hits <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        qs <span class="op">=</span> row[<span class="st">&quot;dialogue_conv_questions&quot;</span>]</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        gold <span class="op">=</span> row[<span class="st">&quot;dialogue_executed_answers&quot;</span>]</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        ems <span class="op">=</span> []</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        exec_flags <span class="op">=</span> []</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(qs)):</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>            inp <span class="op">=</span> build_inputs_from_row(row, t)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>            out <span class="op">=</span> model(<span class="op">**</span>inp)  <span class="co"># out.ops, out.answer</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>            pa <span class="op">=</span> norm_ans(out.answer)</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>            ga <span class="op">=</span> norm_ans(gold[t])</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>            em <span class="op">=</span> <span class="bu">float</span>(pa <span class="op">==</span> ga)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>            ems.append(em)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>            turn_hits <span class="op">+=</span> em</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>            turn_tot <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># (optional) exec check if you have your python DSL evaluator:</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># exec_ok = False</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># try:</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     # exec_ok = (run_dsl(out.ops, inp) == ga)   # plug your interpreter</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     exec_ok = False</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># except Exception:</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     exec_ok = False</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>            <span class="co"># exec_flags.append(exec_ok)</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>            <span class="co"># exec_hits += float(exec_ok)</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>        dlg_mean_ems.append(<span class="bu">sum</span>(ems) <span class="op">/</span> <span class="bu">len</span>(ems))</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">all</span>(v <span class="op">==</span> <span class="fl">1.0</span> <span class="cf">for</span> v <span class="kw">in</span> ems):</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>            dlg_joint_hits <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        final_hits <span class="op">+=</span> ems[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;turn_em_micro&quot;</span>: turn_hits <span class="op">/</span> <span class="bu">max</span>(<span class="dv">1</span>, turn_tot),</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;dlg_mean_em_macro&quot;</span>: <span class="bu">sum</span>(dlg_mean_ems) <span class="op">/</span> <span class="bu">max</span>(<span class="dv">1</span>, <span class="bu">len</span>(dlg_mean_ems)),</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;joint_em&quot;</span>: dlg_joint_hits <span class="op">/</span> <span class="bu">max</span>(<span class="dv">1</span>, <span class="bu">len</span>(dlg_mean_ems)),</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;final_turn_em&quot;</span>: final_hits <span class="op">/</span> <span class="bu">max</span>(<span class="dv">1</span>, <span class="bu">len</span>(dlg_mean_ems)),</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># &quot;exec_agree_rate&quot;: exec_hits / max(1, turn_tot),</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;n_dialogues&quot;</span>: <span class="bu">len</span>(dlg_mean_ems),</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;n_turns&quot;</span>: turn_tot,</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
</div>
<p>Next, we will create the DSPy metric, used to <em>evaluate</em> the performance of our model.</p>
<p>We will focus on 2 parts to our metric: - If the answer is a floating point number, we will aim to compare it with the ground truth with some tolerance. - If the answer is a string, we will aim to perform <strong>exact match</strong> via DSPy‚Äôs <code>exact_match</code> metric.</p>
<div id="cell-18" class="cell" data-execution_count="407">
<div class="sourceCode" id="cb10"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> turn_em_metric(example, pred, trace<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute turn-level exact match (EM) metric for a single example/prediction pair.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">        example: dict-like, must contain &quot;gold_answer&quot; key.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">        pred: object with an &quot;answer&quot; attribute.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">        float: 1.0 if normalized prediction matches normalized gold answer (with tolerance for floats), else 0.0.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> dspy.evaluate.metrics <span class="im">import</span> answer_exact_match</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    pa <span class="op">=</span> norm_ans(pred.answer)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    ga <span class="op">=</span> norm_ans(example[<span class="st">&quot;answer&quot;</span>])</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(pa, <span class="bu">float</span>) <span class="kw">and</span> <span class="bu">isinstance</span>(ga, <span class="bu">float</span>):</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">float</span>(<span class="bu">abs</span>(pa <span class="op">-</span> ga) <span class="op">&lt;=</span> <span class="fl">1e-2</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># exact_match in DSPy needs the inputs to be in string format</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># due to the normalisations DSPy performs internally.</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        ground_truth <span class="op">=</span> dspy.Prediction(answer<span class="op">=</span><span class="bu">str</span>(example.answer))</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        pred_answer <span class="op">=</span> dspy.Prediction(answer<span class="op">=</span><span class="bu">str</span>(pred.answer))</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">float</span>(answer_exact_match(ground_truth, pred_answer))</span></code></pre></div>
</div>
<div id="cell-19" class="cell" data-execution_count="408">
<div class="sourceCode" id="cb11"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_turn_examples(df, history_mode<span class="op">=</span><span class="st">&quot;teacher&quot;</span>):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    examples <span class="op">=</span> []</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        qs <span class="op">=</span> row[<span class="st">&quot;dialogue_conv_questions&quot;</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        gold <span class="op">=</span> row[<span class="st">&quot;dialogue_executed_answers&quot;</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(qs)):</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            inp <span class="op">=</span> build_inputs_from_row(row, t, history_mode<span class="op">=</span>history_mode)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            ex <span class="op">=</span> <span class="bu">dict</span>(<span class="op">**</span>inp, answer<span class="op">=</span>gold[t])</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            examples.append(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                dspy.Example(<span class="op">**</span>ex).with_inputs(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;conversation_context&quot;</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;evidence_snippets&quot;</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;table&quot;</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;question&quot;</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> examples</span></code></pre></div>
</div>
<p>Next, we will prepare our datasets.</p>
<p>We will aim to use the splits as follows: - <code>train</code>: Used primarily for the <em>optimisation</em> phase. This will be discussed shortly. - <code>valid</code>: Used to evaluate the performance of an LM on an optimised model <em>trained</em> using the train dataset. - <code>test</code>: Used to evaluate the performance of an LM on a held-out dataset. This will determine the overall stage performance.</p>
<div id="cell-21" class="cell" data-execution_count="409">
<div class="sourceCode" id="cb12"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> pd.DataFrame(data[<span class="st">&quot;train&quot;</span>])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> pd.DataFrame(data[<span class="st">&quot;dev&quot;</span>])</span></code></pre></div>
</div>
<div id="cell-22" class="cell" data-execution_count="410">
<div class="sourceCode" id="cb13"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Flatten features to remove the indexing gymnastics</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>train_flat_df <span class="op">=</span> pd.concat(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        train_df.drop([<span class="st">&quot;doc&quot;</span>, <span class="st">&quot;dialogue&quot;</span>, <span class="st">&quot;features&quot;</span>], axis<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        train_df[<span class="st">&quot;doc&quot;</span>].<span class="bu">apply</span>(pd.Series).add_prefix(<span class="st">&quot;doc_&quot;</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        train_df[<span class="st">&quot;dialogue&quot;</span>].<span class="bu">apply</span>(pd.Series).add_prefix(<span class="st">&quot;dialogue_&quot;</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        train_df[<span class="st">&quot;features&quot;</span>].<span class="bu">apply</span>(pd.Series).add_prefix(<span class="st">&quot;features_&quot;</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>test_flat_df <span class="op">=</span> pd.concat(</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        test_df.drop([<span class="st">&quot;doc&quot;</span>, <span class="st">&quot;dialogue&quot;</span>, <span class="st">&quot;features&quot;</span>], axis<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        test_df[<span class="st">&quot;doc&quot;</span>].<span class="bu">apply</span>(pd.Series).add_prefix(<span class="st">&quot;doc_&quot;</span>),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        test_df[<span class="st">&quot;dialogue&quot;</span>].<span class="bu">apply</span>(pd.Series).add_prefix(<span class="st">&quot;dialogue_&quot;</span>),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        test_df[<span class="st">&quot;features&quot;</span>].<span class="bu">apply</span>(pd.Series).add_prefix(<span class="st">&quot;features_&quot;</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="cell-23" class="cell" data-execution_count="411">
<div class="sourceCode" id="cb14"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>train_flat_df.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="411">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">doc_pre_text</th>
<th data-quarto-table-cell-role="th">doc_post_text</th>
<th data-quarto-table-cell-role="th">doc_table</th>
<th data-quarto-table-cell-role="th">dialogue_conv_questions</th>
<th data-quarto-table-cell-role="th">dialogue_conv_answers</th>
<th data-quarto-table-cell-role="th">dialogue_turn_program</th>
<th data-quarto-table-cell-role="th">dialogue_executed_answers</th>
<th data-quarto-table-cell-role="th">dialogue_qa_split</th>
<th data-quarto-table-cell-role="th">features_num_dialogue_turns</th>
<th data-quarto-table-cell-role="th">features_has_type2_question</th>
<th data-quarto-table-cell-role="th">features_has_duplicate_columns</th>
<th data-quarto-table-cell-role="th">features_has_non_numeric_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Single_JKHY/2009/page_28.pdf-3</td>
<td>26 | 2009 annual report in fiscal 2008 , revenues in the credit un...</td>
<td>year ended june 30 , cash provided by operations increased $ 25587...</td>
<td>{'Year ended June 30, 2009': {'net income': 103102.0, 'non-cash ex...</td>
<td>[what is the net cash from operating activities in 2009?, what abo...</td>
<td>[206588, 181001, 25587, 14.1%]</td>
<td>[206588, 181001, subtract(206588, 181001), subtract(206588, 181001...</td>
<td>[206588.0, 181001.0, 25587.0, 0.14136]</td>
<td>[False, False, False, False]</td>
<td>4</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Single_RSG/2008/page_114.pdf-2</td>
<td>substantially all of the goodwill and other intangible assets reco...</td>
<td>the above unaudited pro forma financial information includes adjus...</td>
<td>{'year ended december 31 2008 ( unaudited )': {'revenue': 9362.2, ...</td>
<td>[what were revenues in 2008?, what were they in 2007?, what was th...</td>
<td>[9362.2, 9244.9, 117.3, 1.3%]</td>
<td>[9362.2, 9244.9, subtract(9362.2, 9244.9), subtract(9362.2, 9244.9...</td>
<td>[9362.2, 9244.9, 117.3, 0.01269]</td>
<td>[False, False, False, False]</td>
<td>4</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Single_AAPL/2002/page_23.pdf-1</td>
<td>in a new business model such as the retail segment is inherently r...</td>
<td>.</td>
<td>{'2002': {'net sales': 5742.0, 'cost of sales': 4139.0, 'gross mar...</td>
<td>[what was the total of net sales in 2001?, and what was that in 20...</td>
<td>[5363, 7983, -2620, -32%]</td>
<td>[5363, 7983, subtract(5363, 7983), subtract(5363, 7983), divide(#0...</td>
<td>[5363.0, 7983.0, -2620.0, -0.3282]</td>
<td>[False, False, False, False]</td>
<td>4</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Single_UPS/2009/page_33.pdf-2</td>
<td>( 1 ) includes shares repurchased through our publicly announced s...</td>
<td>.</td>
<td>{'12/31/04': {'united parcel service inc .': 100.0, 's&amp;p 500 index...</td>
<td>[what was the change in the performance of the united parcel servi...</td>
<td>[-24.05, -24.05%, 102.11, 2.11, 2.11%, -26.16%]</td>
<td>[subtract(75.95, const_100), subtract(75.95, const_100), divide(#0...</td>
<td>[-24.05, -0.2405, 102.11, 2.11, 0.0211, -0.2616]</td>
<td>[False, False, False, False, False, False]</td>
<td>6</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Double_UPS/2009/page_33.pdf</td>
<td>( 1 ) includes shares repurchased through our publicly announced s...</td>
<td>.</td>
<td>{'12/31/04': {'united parcel service inc .': 100.0, 's&amp;p 500 index...</td>
<td>[what was the fluctuation of the performance price of the ups from...</td>
<td>[-8.94, -8.9%, -24.05, -24.05%, 2.11, 2.11%, -26.16%]</td>
<td>[subtract(91.06, const_100), subtract(91.06, const_100), divide(#0...</td>
<td>[-8.94, -0.0894, -24.05, -0.2405, 2.11, 0.0211, -0.2616]</td>
<td>[False, False, True, True, True, True, True]</td>
<td>7</td>
<td>True</td>
<td>False</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="412">
<div class="sourceCode" id="cb15"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>easy_train_ids <span class="op">=</span> pd.read_json(<span class="st">&quot;./splits/easy_train.jsonl&quot;</span>, lines<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>easy_valid_ids <span class="op">=</span> pd.read_json(<span class="st">&quot;./splits/easy_valid.jsonl&quot;</span>, lines<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>easy_test_ids <span class="op">=</span> pd.read_json(<span class="st">&quot;./splits/easy_test.jsonl&quot;</span>, lines<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>medium_train_ids <span class="op">=</span> pd.read_json(<span class="st">&quot;./splits/medium_train.jsonl&quot;</span>, lines<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>medium_valid_ids <span class="op">=</span> pd.read_json(<span class="st">&quot;./splits/medium_valid.jsonl&quot;</span>, lines<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>medium_test_ids <span class="op">=</span> pd.read_json(<span class="st">&quot;./splits/medium_test.jsonl&quot;</span>, lines<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>hard_train_ids <span class="op">=</span> pd.read_json(<span class="st">&quot;./splits/hard_train.jsonl&quot;</span>, lines<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>hard_valid_ids <span class="op">=</span> pd.read_json(<span class="st">&quot;./splits/hard_valid.jsonl&quot;</span>, lines<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>hard_test_ids <span class="op">=</span> pd.read_json(<span class="st">&quot;./splits/hard_test.jsonl&quot;</span>, lines<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>easy_train_df <span class="op">=</span> train_flat_df[train_flat_df[<span class="st">&quot;id&quot;</span>].isin(easy_train_ids[<span class="st">&quot;id&quot;</span>])].copy()</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>easy_valid_df <span class="op">=</span> train_flat_df[train_flat_df[<span class="st">&quot;id&quot;</span>].isin(easy_valid_ids[<span class="st">&quot;id&quot;</span>])].copy()</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>easy_test_df <span class="op">=</span> test_flat_df[test_flat_df[<span class="st">&quot;id&quot;</span>].isin(easy_test_ids[<span class="st">&quot;id&quot;</span>])].copy()</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>medium_train_df <span class="op">=</span> train_flat_df[train_flat_df[<span class="st">&quot;id&quot;</span>].isin(medium_train_ids[<span class="st">&quot;id&quot;</span>])].copy()</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>medium_valid_df <span class="op">=</span> train_flat_df[train_flat_df[<span class="st">&quot;id&quot;</span>].isin(medium_valid_ids[<span class="st">&quot;id&quot;</span>])].copy()</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>medium_test_df <span class="op">=</span> test_flat_df[test_flat_df[<span class="st">&quot;id&quot;</span>].isin(medium_test_ids[<span class="st">&quot;id&quot;</span>])].copy()</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>hard_train_df <span class="op">=</span> train_flat_df[train_flat_df[<span class="st">&quot;id&quot;</span>].isin(hard_train_ids[<span class="st">&quot;id&quot;</span>])].copy()</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>hard_valid_df <span class="op">=</span> train_flat_df[train_flat_df[<span class="st">&quot;id&quot;</span>].isin(hard_valid_ids[<span class="st">&quot;id&quot;</span>])].copy()</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>hard_test_df <span class="op">=</span> test_flat_df[test_flat_df[<span class="st">&quot;id&quot;</span>].isin(hard_test_ids[<span class="st">&quot;id&quot;</span>])].copy()</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> easy_train_ids.shape[<span class="dv">0</span>] <span class="op">==</span> easy_train_df.shape[<span class="dv">0</span>]</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> easy_valid_ids.shape[<span class="dv">0</span>] <span class="op">==</span> easy_valid_df.shape[<span class="dv">0</span>]</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> easy_test_ids.shape[<span class="dv">0</span>] <span class="op">==</span> easy_test_df.shape[<span class="dv">0</span>]</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> medium_train_ids.shape[<span class="dv">0</span>] <span class="op">==</span> medium_train_df.shape[<span class="dv">0</span>]</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> medium_valid_ids.shape[<span class="dv">0</span>] <span class="op">==</span> medium_valid_df.shape[<span class="dv">0</span>]</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> medium_test_ids.shape[<span class="dv">0</span>] <span class="op">==</span> medium_test_df.shape[<span class="dv">0</span>]</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> hard_train_ids.shape[<span class="dv">0</span>] <span class="op">==</span> hard_train_df.shape[<span class="dv">0</span>]</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> hard_valid_ids.shape[<span class="dv">0</span>] <span class="op">==</span> hard_valid_df.shape[<span class="dv">0</span>]</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> hard_test_ids.shape[<span class="dv">0</span>] <span class="op">==</span> hard_test_df.shape[<span class="dv">0</span>]</span></code></pre></div>
</div>
<div id="cell-25" class="cell" data-execution_count="413">
<div class="sourceCode" id="cb16"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>easy_train_examples <span class="op">=</span> to_turn_examples(easy_train_df)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>easy_valid_examples <span class="op">=</span> to_turn_examples(easy_valid_df)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>easy_test_examples <span class="op">=</span> to_turn_examples(easy_test_df)</span></code></pre></div>
</div>
<div id="cell-26" class="cell" data-execution_count="414">
<div class="sourceCode" id="cb17"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(easy_train_examples <span class="op">+</span> easy_valid_examples)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="414">
<pre><code>852</code></pre>
</div>
</div>
<p>We will used DSPy‚Äôs <code>Evaluate</code> class to run our evals in parallel(internally, this is just implemented via threads)</p>
<p>To ensure our setup works as expected, we will run a simple test first.</p>
<div id="cell-29" class="cell" data-execution_count="419">
<div class="sourceCode" id="cb19"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dspy.evaluate <span class="im">import</span> Evaluate</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>evaluator <span class="op">=</span> Evaluate(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    devset<span class="op">=</span>easy_valid_examples[:<span class="dv">10</span>],</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    num_threads<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    display_progress<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    display_table<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    provide_traceback<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    return_all_scores<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    return_outputs<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> copy <span class="im">import</span> deepcopy</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>tlm <span class="op">=</span> deepcopy(lm_oai_gpt_4_1)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>tlm.cache <span class="op">=</span> <span class="va">False</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">HACK</span><span class="co">: Weird bug in dspy where the context doesn&#39;t set the cache to False, causing answers to be returned from memory. I&#39;ve found that creating a deepcopy and setting the attribute manually fixes this.</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> dspy.context(lm<span class="op">=</span>tlm) <span class="im">as</span> ctx:</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    evaluator(TurnSolver(reasoning_lm<span class="op">=</span><span class="va">False</span>), metric<span class="op">=</span>turn_em_metric)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 8.00 / 10 (80.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:02&lt;00:00,  3.48it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:18:42 INFO dspy.evaluate.evaluate: Average Metric: 8.0 / 10 (80.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">conversation_context</th>
<th data-quarto-table-cell-role="th">evidence_snippets</th>
<th data-quarto-table-cell-role="th">table</th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">doc_pre_text</th>
<th data-quarto-table-cell-role="th">doc_post_text</th>
<th data-quarto-table-cell-role="th">doc_table</th>
<th data-quarto-table-cell-role="th">dialogue_conv_questions</th>
<th data-quarto-table-cell-role="th">dialogue_conv_answers</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">dialogue_executed_answers</th>
<th data-quarto-table-cell-role="th">dialogue_qa_split</th>
<th data-quarto-table-cell-role="th">features_num_dialogue_turns</th>
<th data-quarto-table-cell-role="th">features_has_type2_question</th>
<th data-quarto-table-cell-role="th">features_has_duplicate_columns</th>
<th data-quarto-table-cell-role="th">features_has_non_numeric_values</th>
<th data-quarto-table-cell-role="th">example_answer</th>
<th data-quarto-table-cell-role="th">ops</th>
<th data-quarto-table-cell-role="th">pred_answer</th>
<th data-quarto-table-cell-role="th">turn_em_metric</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>None</td>
<td>[PRE] entergy corporation and subsidiaries management's financial ...</td>
<td>| Row | 2009 net revenue | volume/weather | retail electric price ...</td>
<td>what was the difference in net revenue between 2009 and 2010?</td>
<td>Single_ETR/2011/page_22.pdf-3</td>
<td>entergy corporation and subsidiaries management's financial discus...</td>
<td>the volume/weather variance is primarily due to an increase of 836...</td>
<td>{'amount ( in millions )': {'2009 net revenue': 4694.0, 'volume/we...</td>
<td>['what was the difference in net revenue between 2009 and 2010?', ...</td>
<td>[357, 4694, 7.61%]</td>
<td>...</td>
<td>[357.0, 4694.0, 0.07605]</td>
<td>[False, False, False]</td>
<td>3</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>357.00000</td>
<td>subtract(2010 net revenue, 2009 net revenue)</td>
<td>357.0</td>
<td>‚úîÔ∏è [1.000]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Q1: what was the difference in net revenue between 2009 and 2010?\...</td>
<td>[PRE] entergy corporation and subsidiaries management's financial ...</td>
<td>| Row | 2009 net revenue | volume/weather | retail electric price ...</td>
<td>and the specific value for 2009 again?</td>
<td>Single_ETR/2011/page_22.pdf-3</td>
<td>entergy corporation and subsidiaries management's financial discus...</td>
<td>the volume/weather variance is primarily due to an increase of 836...</td>
<td>{'amount ( in millions )': {'2009 net revenue': 4694.0, 'volume/we...</td>
<td>['what was the difference in net revenue between 2009 and 2010?', ...</td>
<td>[357, 4694, 7.61%]</td>
<td>...</td>
<td>[357.0, 4694.0, 0.07605]</td>
<td>[False, False, False]</td>
<td>3</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>4694.00000</td>
<td>4694.0</td>
<td>4694.0</td>
<td>‚úîÔ∏è [1.000]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Q1: what was the difference in net revenue between 2009 and 2010?\...</td>
<td>[PRE] entergy corporation and subsidiaries management's financial ...</td>
<td>| Row | 2009 net revenue | volume/weather | retail electric price ...</td>
<td>so what was the percentage change during this time?</td>
<td>Single_ETR/2011/page_22.pdf-3</td>
<td>entergy corporation and subsidiaries management's financial discus...</td>
<td>the volume/weather variance is primarily due to an increase of 836...</td>
<td>{'amount ( in millions )': {'2009 net revenue': 4694.0, 'volume/we...</td>
<td>['what was the difference in net revenue between 2009 and 2010?', ...</td>
<td>[357, 4694, 7.61%]</td>
<td>...</td>
<td>[357.0, 4694.0, 0.07605]</td>
<td>[False, False, False]</td>
<td>3</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>0.07605</td>
<td>subtract(5051.0, 4694.0), divide(#0, 4694.0), multiply(#1, const_100)</td>
<td>7.61</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>None</td>
<td>[PRE] entergy new orleans , inc . management's financial discussio...</td>
<td>| Row | 2003 net revenue | base rates | volume/weather | 2004 defe...</td>
<td>what was the net revenue in 2004?</td>
<td>Single_ETR/2004/page_258.pdf-4</td>
<td>entergy new orleans , inc . management's financial discussion and ...</td>
<td>the increase in base rates was effective june 2003 . the rate incr...</td>
<td>{'( in millions )': {'2003 net revenue': 208.3, 'base rates': 10.6...</td>
<td>[what was the net revenue in 2004?, what was the net revenue in 20...</td>
<td>[239.0, 208.3, 30.7, 14.7%]</td>
<td>...</td>
<td>[239.0, 208.3, 30.7, 0.14738]</td>
<td>[False, False, False, False]</td>
<td>4</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>239.00000</td>
<td>None</td>
<td>239.0</td>
<td>‚úîÔ∏è [1.000]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Q1: what was the net revenue in 2004?\nA1: 239.0</td>
<td>[PRE] entergy new orleans , inc . management's financial discussio...</td>
<td>| Row | 2003 net revenue | base rates | volume/weather | 2004 defe...</td>
<td>what was the net revenue in 2003?</td>
<td>Single_ETR/2004/page_258.pdf-4</td>
<td>entergy new orleans , inc . management's financial discussion and ...</td>
<td>the increase in base rates was effective june 2003 . the rate incr...</td>
<td>{'( in millions )': {'2003 net revenue': 208.3, 'base rates': 10.6...</td>
<td>[what was the net revenue in 2004?, what was the net revenue in 20...</td>
<td>[239.0, 208.3, 30.7, 14.7%]</td>
<td>...</td>
<td>[239.0, 208.3, 30.7, 0.14738]</td>
<td>[False, False, False, False]</td>
<td>4</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>208.30000</td>
<td>None</td>
<td>208.3</td>
<td>‚úîÔ∏è [1.000]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Q1: what was the net revenue in 2004?\nA1: 239.0\nQ2: what was the...</td>
<td>[PRE] entergy new orleans , inc . management's financial discussio...</td>
<td>| Row | 2003 net revenue | base rates | volume/weather | 2004 defe...</td>
<td>what was the change in value?</td>
<td>Single_ETR/2004/page_258.pdf-4</td>
<td>entergy new orleans , inc . management's financial discussion and ...</td>
<td>the increase in base rates was effective june 2003 . the rate incr...</td>
<td>{'( in millions )': {'2003 net revenue': 208.3, 'base rates': 10.6...</td>
<td>[what was the net revenue in 2004?, what was the net revenue in 20...</td>
<td>[239.0, 208.3, 30.7, 14.7%]</td>
<td>...</td>
<td>[239.0, 208.3, 30.7, 0.14738]</td>
<td>[False, False, False, False]</td>
<td>4</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>30.70000</td>
<td>subtract(239.0, 208.3)</td>
<td>30.7</td>
<td>‚úîÔ∏è [1.000]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Q1: what was the net revenue in 2004? A1: 239.0 Q2: what was the n...</td>
<td>[PRE] entergy new orleans , inc . management's financial discussio...</td>
<td>| Row | 2003 net revenue | base rates | volume/weather | 2004 defe...</td>
<td>what is the percent change?</td>
<td>Single_ETR/2004/page_258.pdf-4</td>
<td>entergy new orleans , inc . management's financial discussion and ...</td>
<td>the increase in base rates was effective june 2003 . the rate incr...</td>
<td>{'( in millions )': {'2003 net revenue': 208.3, 'base rates': 10.6...</td>
<td>[what was the net revenue in 2004?, what was the net revenue in 20...</td>
<td>[239.0, 208.3, 30.7, 14.7%]</td>
<td>...</td>
<td>[239.0, 208.3, 30.7, 0.14738]</td>
<td>[False, False, False, False]</td>
<td>4</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>0.14738</td>
<td>subtract(239.0, 208.3), divide(#0, 208.3), multiply(#1, 100)</td>
<td>14.72</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>None</td>
<td>[PRE] nike , inc . notes to consolidated financial statements 2014...</td>
<td>| Row | severance and related costs | cash payments | non-cash sto...</td>
<td>what was the value of the sale of the starter brand?</td>
<td>Single_NKE/2009/page_81.pdf-1</td>
<td>nike , inc . notes to consolidated financial statements 2014 ( con...</td>
<td>the accrual balance as of may 31 , 2009 will be relieved throughou...</td>
<td>{'$ 2014': {'severance and related costs': 195.0, 'cash payments':...</td>
<td>['what was the value of the sale of the starter brand?', 'what was...</td>
<td>[60.0, 28.6, 31.4, 91%]</td>
<td>...</td>
<td>[60.0, 28.6, 31.4, 0.91083]</td>
<td>[False, False, False, False]</td>
<td>4</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>60.00000</td>
<td>None</td>
<td>60.0</td>
<td>‚úîÔ∏è [1.000]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Q1: what was the value of the sale of the starter brand?\nA1: 60.0</td>
<td>[PRE] nike , inc . notes to consolidated financial statements 2014...</td>
<td>| Row | severance and related costs | cash payments | non-cash sto...</td>
<td>what was the gain resulting from the sale?</td>
<td>Single_NKE/2009/page_81.pdf-1</td>
<td>nike , inc . notes to consolidated financial statements 2014 ( con...</td>
<td>the accrual balance as of may 31 , 2009 will be relieved throughou...</td>
<td>{'$ 2014': {'severance and related costs': 195.0, 'cash payments':...</td>
<td>['what was the value of the sale of the starter brand?', 'what was...</td>
<td>[60.0, 28.6, 31.4, 91%]</td>
<td>...</td>
<td>[60.0, 28.6, 31.4, 0.91083]</td>
<td>[False, False, False, False]</td>
<td>4</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>28.60000</td>
<td>None</td>
<td>28.6</td>
<td>‚úîÔ∏è [1.000]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Q1: what was the value of the sale of the starter brand?\nA1: 60.0...</td>
<td>[PRE] nike , inc . notes to consolidated financial statements 2014...</td>
<td>| Row | severance and related costs | cash payments | non-cash sto...</td>
<td>what was the change in value?</td>
<td>Single_NKE/2009/page_81.pdf-1</td>
<td>nike , inc . notes to consolidated financial statements 2014 ( con...</td>
<td>the accrual balance as of may 31 , 2009 will be relieved throughou...</td>
<td>{'$ 2014': {'severance and related costs': 195.0, 'cash payments':...</td>
<td>['what was the value of the sale of the starter brand?', 'what was...</td>
<td>[60.0, 28.6, 31.4, 91%]</td>
<td>...</td>
<td>[60.0, 28.6, 31.4, 0.91083]</td>
<td>[False, False, False, False]</td>
<td>4</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>31.40000</td>
<td>subtract(60.0, 28.6)</td>
<td>31.4</td>
<td>‚úîÔ∏è [1.000]</td>
</tr>
</tbody>
</table>

<p>10 rows √ó 21 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/a5433773d6ef4e359825412ad138c520
üß™ View experiment at: http://localhost:5000/#/experiments/1</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>
  <style scoped>
  button {
    border: none;
    border-radius: 4px;
    background-color: rgb(34, 114, 180);
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial;
    font-size: 13px;
    color: white;
    margin-top: 8px;
    margin-bottom: 8px;
    padding: 8px 16px;
    cursor: pointer;
  }
  button:hover {
    background-color: rgb(66, 153, 224);
  }
  </style>
  <button
    onclick="
        const display = this.nextElementSibling.style.display;
        const isCollapsed = display === 'none';
        this.nextElementSibling.style.display = isCollapsed ? null : 'none';

        const verb = isCollapsed ? 'Collapse' : 'Expand';
        this.innerText = `${verb} MLflow Trace`;
    "
  >Collapse MLflow Trace</button>
  <iframe
    id="trace-renderer"
    style="width: 100%; height: 500px; border: none; resize: vertical;"
    src="http://localhost:5000/static-files/lib/notebook-trace-renderer/index.html?trace_id=caea82d0bc0c4f0d800313b99bd69581&amp;experiment_id=1&amp;trace_id=ed4476c7920b49f3b2e909e88548e086&amp;experiment_id=1&amp;trace_id=6ba8b539ea0f49798599b294060d1213&amp;experiment_id=1&amp;trace_id=711aae8d07b14f619312af02495f941a&amp;experiment_id=1&amp;trace_id=fd97772c93064b3daf30f61009d81fe2&amp;experiment_id=1&amp;trace_id=5b665669eca649c9bd46b04a6f9737ad&amp;experiment_id=1&amp;trace_id=23be442a4d64413abe335a55bebe6a5a&amp;experiment_id=1&amp;trace_id=d057b5aed88a46fb8562a39db0ebd15d&amp;experiment_id=1&amp;trace_id=02f1ddeee02448f58babae2fb6afa3b9&amp;experiment_id=1&amp;trace_id=8e058d1aa41a4932a83c8f0505a867fd&amp;experiment_id=1&amp;version=3.1.4"
  />
</div>
</div>
</div>
<div id="cell-30" class="cell">
<div class="sourceCode" id="cb24"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>bootstrap_rs_random_easy_subset <span class="op">=</span> random.sample(easy_train_examples, <span class="dv">70</span>)</span></code></pre></div>
</div>
<div id="cell-31" class="cell">
<div class="sourceCode" id="cb25"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> litellm</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dspy.teleprompt <span class="im">import</span> BootstrapFewShotWithRandomSearch</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Config needed to prevent the optimizer from using _unsupported_ temperature</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for reasoning models.</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>litellm.drop_params <span class="op">=</span> <span class="va">True</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    max_bootstrapped_demos<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    max_labeled_demos<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    num_candidate_programs<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    num_threads<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    max_rounds<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>bootstrap_rs_easy_compiled_programs <span class="op">=</span> []</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> mlflow.start_run(run_name<span class="op">=</span><span class="st">&quot;bootstrap_few_shot_rs_easy&quot;</span>):</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> candidate_lm <span class="kw">in</span> selected_llms:</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        run_name <span class="op">=</span> <span class="ss">f&quot;bootstrap_few_shot_rs_</span><span class="sc">{</span>candidate_lm<span class="sc">.</span>model<span class="sc">.</span>replace(<span class="st">&#39;/&#39;</span>, <span class="st">&#39;_&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        sanitized_run_name <span class="op">=</span> re.sub(<span class="vs">r&quot;</span><span class="pp">[^a-zA-Z0-9_</span><span class="ch">\-</span><span class="pp">]</span><span class="vs">&quot;</span>, <span class="st">&quot;_&quot;</span>, run_name)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> mlflow.start_run(run_name<span class="op">=</span>sanitized_run_name, nested<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> dspy.context(lm<span class="op">=</span>candidate_lm) <span class="im">as</span> ctx:</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>                teleprompter <span class="op">=</span> BootstrapFewShotWithRandomSearch(</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>                    metric<span class="op">=</span>turn_em_metric, <span class="op">**</span>config</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>                optimized_program <span class="op">=</span> teleprompter.<span class="bu">compile</span>(</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>                    dspy.ChainOfThought(SolveTurnWithReasoning),</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>                    trainset<span class="op">=</span>bootstrap_rs_random_easy_subset,</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>                bootstrap_rs_easy_compiled_programs.append(optimized_program)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Going to sample between 1 and 3 traces per predictor.
Will attempt to bootstrap 5 candidate sets.
Average Metric: 45.00 / 70 (64.3%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:00&lt;00:00, 87.74it/s] </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:08 INFO dspy.evaluate.evaluate: Average Metric: 45.0 / 70 (64.3%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_0 at: http://localhost:5000/#/experiments/3/runs/fcce9b07d50e41609bc04c3d9c2235c7
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 64.29 for seed -3
Scores so far: [64.29]
Best score so far: 64.29
  0%|          | 0/70 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:08 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 26.00 / 38 (68.4%):  53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 37/70 [00:00&lt;00:00, 82.89it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:08 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 46.00 / 70 (65.7%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:00&lt;00:00, 76.35it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:09 INFO dspy.evaluate.evaluate: Average Metric: 46.0 / 70 (65.7%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_1 at: http://localhost:5000/#/experiments/3/runs/7575401319f442499f871ca8d849bfd1
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 65.71 for seed -2
Scores so far: [64.29, 65.71]
Best score so far: 65.71</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9aa596c147174804958bfd90f9e69998","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  4%|‚ñç         | 3/70 [00:00&lt;00:04, 13.83it/s]2025/07/29 01:03:09 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
  9%|‚ñä         | 6/70 [00:00&lt;00:03, 16.05it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 3 full traces after 6 examples for up to 1 rounds, amounting to 6 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2fac575b2f714ab3a5f079b5b8c068e7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 47.00 / 70 (67.1%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 62.67it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:11 INFO dspy.evaluate.evaluate: Average Metric: 47.0 / 70 (67.1%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_2 at: http://localhost:5000/#/experiments/3/runs/3406309f3f0a4041a580021eaf5eff13
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 67.14 for seed -1
Scores so far: [64.29, 65.71, 67.14]
Best score so far: 67.14</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9352e516d8b848579ba0d22b01c35fb2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  3%|‚ñé         | 2/70 [00:00&lt;00:02, 32.62it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 2 full traces after 2 examples for up to 1 rounds, amounting to 2 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"dd46b6737ed8418484d64e9cef39a594","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 48.00 / 70 (68.6%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 52.08it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:12 INFO dspy.evaluate.evaluate: Average Metric: 48.0 / 70 (68.6%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_3 at: http://localhost:5000/#/experiments/3/runs/8cad7a93fb494289a4d6691d5796f84e
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 68.57 for seed 0
Scores so far: [64.29, 65.71, 67.14, 68.57]
Best score so far: 68.57</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"19d7fe20fa6b4fb7bb39768109a6e96f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:00&lt;00:03, 18.44it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d9ac51afacd244629a94d3d29cc78260","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 46.00 / 70 (65.7%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 54.10it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:15 INFO dspy.evaluate.evaluate: Average Metric: 46.0 / 70 (65.7%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_4 at: http://localhost:5000/#/experiments/3/runs/ab8c076e18394080bbf9634eeff7af35
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [64.29, 65.71, 67.14, 68.57, 65.71]
Best score so far: 68.57</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"71a5a9849439471b90be1451f4ed6d8c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:00&lt;00:02, 24.59it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"795ab895387b4c0e9eac571ee453ac88","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 45.00 / 70 (64.3%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 44.09it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:17 INFO dspy.evaluate.evaluate: Average Metric: 45.0 / 70 (64.3%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_5 at: http://localhost:5000/#/experiments/3/runs/679c914720674946a877f4a6a91665ee
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [64.29, 65.71, 67.14, 68.57, 65.71, 64.29]
Best score so far: 68.57</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"650c0bd2cb2a4041bdf156931c25130c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:00&lt;00:12,  5.70it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f16c05df32404d64b8a8431d48d39234","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 47.00 / 70 (67.1%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 61.09it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:19 INFO dspy.evaluate.evaluate: Average Metric: 47.0 / 70 (67.1%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_6 at: http://localhost:5000/#/experiments/3/runs/ab818ec11652430b9bd68e17dc197665
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [64.29, 65.71, 67.14, 68.57, 65.71, 64.29, 67.14]
Best score so far: 68.57</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0479a155634a4c4ba4d92bebca0b0727","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:00&lt;00:02, 28.38it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ea69ff24378d45a3998851b5aa0962d4","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 51.00 / 70 (72.9%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 51.33it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:21 INFO dspy.evaluate.evaluate: Average Metric: 51.0 / 70 (72.9%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_7 at: http://localhost:5000/#/experiments/3/runs/f9f17e61c1334a9ea6903ae3a1105fd8
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 72.86 for seed 4
Scores so far: [64.29, 65.71, 67.14, 68.57, 65.71, 64.29, 67.14, 72.86]
Best score so far: 72.86
8 candidate programs found.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8b8c7a6497d04213a381c037724d4895","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>üèÉ View run bootstrap_few_shot_rs_openai_o4-mini-2025-04-16 at: http://localhost:5000/#/experiments/3/runs/b08500752c9041d5acccbc261bd33931
üß™ View experiment at: http://localhost:5000/#/experiments/3
Going to sample between 1 and 3 traces per predictor.
Will attempt to bootstrap 5 candidate sets.
  0%|          | 0/70 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:21 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 43.00 / 70 (61.4%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 48.03it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:22 INFO dspy.evaluate.evaluate: Average Metric: 43.0 / 70 (61.4%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_0 at: http://localhost:5000/#/experiments/3/runs/578a2f04172f4ecbb41d04350201b2d5
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 61.43 for seed -3
Scores so far: [61.43]
Best score so far: 61.43
  0%|          | 0/70 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:23 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 29.00 / 42 (69.0%):  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 41/70 [00:01&lt;00:00, 32.19it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:24 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 35.00 / 51 (68.6%):  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 50/70 [00:01&lt;00:00, 42.39it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:24 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 47.00 / 70 (67.1%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 43.35it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:24 INFO dspy.evaluate.evaluate: Average Metric: 47.0 / 70 (67.1%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_1 at: http://localhost:5000/#/experiments/3/runs/cf868ddb4c5945149422186e878e4ee8
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 67.14 for seed -2
Scores so far: [61.43, 67.14]
Best score so far: 67.14</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bc397a6b03924336bbc43a1bd839784c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  9%|‚ñä         | 6/70 [00:00&lt;00:03, 16.98it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 3 full traces after 6 examples for up to 1 rounds, amounting to 6 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d43544d6f72f40dbaae08ad6b18cb0bd","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 46.00 / 70 (65.7%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 65.12it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:27 INFO dspy.evaluate.evaluate: Average Metric: 46.0 / 70 (65.7%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_2 at: http://localhost:5000/#/experiments/3/runs/a83ba7facae34ee2b495fd0bcb478044
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [61.43, 67.14, 65.71]
Best score so far: 67.14</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4e7c85dbd6f64f61a359ea5a37c40ed0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  3%|‚ñé         | 2/70 [00:00&lt;00:03, 21.93it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 2 full traces after 2 examples for up to 1 rounds, amounting to 2 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6913487151e04ab7a89037c30da2cfd7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 46.00 / 70 (65.7%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 36.63it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:30 INFO dspy.evaluate.evaluate: Average Metric: 46.0 / 70 (65.7%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_3 at: http://localhost:5000/#/experiments/3/runs/343b2f8e893044da9a9bee74f6be8853
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [61.43, 67.14, 65.71, 65.71]
Best score so far: 67.14</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cf6a3e6ba2a646a093455efcf2d34a65","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:00&lt;00:02, 28.87it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"102094c059e84577861cd1271f22e414","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 45.00 / 70 (64.3%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 37.96it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:32 INFO dspy.evaluate.evaluate: Average Metric: 45.0 / 70 (64.3%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_4 at: http://localhost:5000/#/experiments/3/runs/3ad1f0eea05b4d7b88e7c47e2c0c29ab
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [61.43, 67.14, 65.71, 65.71, 64.29]
Best score so far: 67.14</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d5351ffa3e234f7f92c3f1932b3dd438","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:00&lt;00:02, 25.21it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d3e11c2f024d4ec090827c250d4258ca","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 47.00 / 70 (67.1%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 35.34it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:34 INFO dspy.evaluate.evaluate: Average Metric: 47.0 / 70 (67.1%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_5 at: http://localhost:5000/#/experiments/3/runs/29b7cf7738bc47d89e81309a65595be0
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [61.43, 67.14, 65.71, 65.71, 64.29, 67.14]
Best score so far: 67.14</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3cff124f59634e5b9279882b0501180a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:00&lt;00:10,  6.34it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"043eb11fea0a462684dac9bbb48f4f03","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 48.00 / 70 (68.6%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:02&lt;00:00, 31.53it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:38 INFO dspy.evaluate.evaluate: Average Metric: 48.0 / 70 (68.6%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_6 at: http://localhost:5000/#/experiments/3/runs/d3a6322d0555421784dbb34087099455
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 68.57 for seed 3
Scores so far: [61.43, 67.14, 65.71, 65.71, 64.29, 67.14, 68.57]
Best score so far: 68.57</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e694033bfb9e4689bd6c07fc39d0801c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:00&lt;00:05, 13.59it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"db37866855a049b88bb7e4c9dd3597c6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 60.00 / 70 (85.7%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:02&lt;00:00, 28.22it/s] </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:41 INFO dspy.evaluate.evaluate: Average Metric: 60.0 / 70 (85.7%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_7 at: http://localhost:5000/#/experiments/3/runs/93c1cafdbb6b440699788970eb6ffa88
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 85.71 for seed 4
Scores so far: [61.43, 67.14, 65.71, 65.71, 64.29, 67.14, 68.57, 85.71]
Best score so far: 85.71
8 candidate programs found.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"93fd5af0c6644afc978088bc68e1ee83","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>üèÉ View run bootstrap_few_shot_rs_gemini_gemini-2_5-flash at: http://localhost:5000/#/experiments/3/runs/621ba195ed244875a4370e2050418a06
üß™ View experiment at: http://localhost:5000/#/experiments/3
Going to sample between 1 and 3 traces per predictor.
Will attempt to bootstrap 5 candidate sets.
  0%|          | 0/70 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:42 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/29 01:03:42 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/29 01:03:42 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/29 01:03:43 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 22.00 / 29 (75.9%):  40%|‚ñà‚ñà‚ñà‚ñà      | 28/70 [00:00&lt;00:00, 71.01it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:43 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 36.00 / 49 (73.5%):  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 48/70 [00:01&lt;00:00, 69.84it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:44 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 52.00 / 70 (74.3%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 37.98it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:44 INFO dspy.evaluate.evaluate: Average Metric: 52.0 / 70 (74.3%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_0 at: http://localhost:5000/#/experiments/3/runs/377a453f2e0745e38fc89508f7ab1d26
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 74.29 for seed -3
Scores so far: [74.29]
Best score so far: 74.29
  0%|          | 0/70 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:44 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 1.00 / 4 (25.0%):   4%|‚ñç         | 3/70 [00:00&lt;00:17,  3.91it/s] </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:45 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 5.00 / 8 (62.5%):  10%|‚ñà         | 7/70 [00:00&lt;00:16,  3.91it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:45 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 13.00 / 16 (81.2%):  23%|‚ñà‚ñà‚ñé       | 16/70 [00:00&lt;00:01, 39.80it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:45 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 30.00 / 41 (73.2%):  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 40/70 [00:01&lt;00:01, 17.35it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:46 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 33.00 / 44 (75.0%):  61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 43/70 [00:01&lt;00:01, 17.35it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:46 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 52.00 / 70 (74.3%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 36.77it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:46 INFO dspy.evaluate.evaluate: Average Metric: 52.0 / 70 (74.3%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_1 at: http://localhost:5000/#/experiments/3/runs/d9e37616e88748d8890de6056370f801
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [74.29, 74.29]
Best score so far: 74.29</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5aa8485009e94f079807723d8dbc5ab2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  6%|‚ñå         | 4/70 [00:00&lt;00:04, 15.37it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 3 full traces after 4 examples for up to 1 rounds, amounting to 4 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e5cce25e5c7941d6bf6a39bcd3c76bf8","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 52.00 / 70 (74.3%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:01&lt;00:00, 35.80it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:03:49 INFO dspy.evaluate.evaluate: Average Metric: 52.0 / 70 (74.3%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_2 at: http://localhost:5000/#/experiments/3/runs/7bfc22c9728f4862931e5bb8bf4d379e
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [74.29, 74.29, 74.29]
Best score so far: 74.29</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f90ceb161810483ab7c0fb2a38dd46e4","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  3%|‚ñé         | 2/70 [00:12&lt;06:55,  6.11s/it]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 2 full traces after 2 examples for up to 1 rounds, amounting to 2 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4d26bd076e4845b193dfa48d40f9e51b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 43.00 / 53 (81.1%):  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 53/70 [00:22&lt;00:09,  1.74it/s] </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:04:25 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 50.00 / 68 (73.5%):  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 68/70 [00:55&lt;00:04,  2.16s/it]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:05:26 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 51.00 / 70 (72.9%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [01:56&lt;00:00,  1.66s/it]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:05:59 INFO dspy.evaluate.evaluate: Average Metric: 51.0 / 70 (72.9%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_3 at: http://localhost:5000/#/experiments/3/runs/7cc38c776c8c40ad983a78690454b768
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [74.29, 74.29, 74.29, 72.86]
Best score so far: 74.29</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2bceaac3cdcd48a0b05bc0f5e0c884a5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:05&lt;06:47,  5.90s/it]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ab959aa00cf145d0984217e3c543fcd0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 34.00 / 37 (91.9%):  53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 37/70 [00:16&lt;00:15,  2.18it/s] </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:06:22 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 49.00 / 62 (79.0%):  89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 62/70 [00:33&lt;00:07,  1.03it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:06:40 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 52.00 / 70 (74.3%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:52&lt;00:00,  1.34it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:06:57 INFO dspy.evaluate.evaluate: Average Metric: 52.0 / 70 (74.3%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_4 at: http://localhost:5000/#/experiments/3/runs/3d4799840b5145f38c55cd04a510b4eb
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [74.29, 74.29, 74.29, 72.86, 74.29]
Best score so far: 74.29</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7a19b204ef7443e3964026a61386dbf3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:03&lt;04:04,  3.55s/it]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0944c174ba5d4b7f888c2c78316eeb67","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 53.00 / 70 (75.7%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:49&lt;00:00,  1.41it/s] </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:07:51 INFO dspy.evaluate.evaluate: Average Metric: 53.0 / 70 (75.7%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_5 at: http://localhost:5000/#/experiments/3/runs/826af9f09c4e4410b2b21424430e67f1
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 75.71 for seed 2
Scores so far: [74.29, 74.29, 74.29, 72.86, 74.29, 75.71]
Best score so far: 75.71</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f58455aed23543369dda147cdcc46ee6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:05&lt;06:22,  5.54s/it]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6f9faa0b381e48b4a3239439f9b5c8a0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 44.00 / 48 (91.7%):  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 48/70 [00:18&lt;00:08,  2.53it/s] </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:08:16 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 53.00 / 70 (75.7%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [01:02&lt;00:00,  1.13it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:08:59 INFO dspy.evaluate.evaluate: Average Metric: 53.0 / 70 (75.7%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_6 at: http://localhost:5000/#/experiments/3/runs/a029e23cfbe14b92a2ba6ce26146642b
üß™ View experiment at: http://localhost:5000/#/experiments/3
Scores so far: [74.29, 74.29, 74.29, 72.86, 74.29, 75.71, 75.71]
Best score so far: 75.71</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"14d1357491a342a6b3cbb1a778076b69","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  1%|‚ñè         | 1/70 [00:04&lt;04:43,  4.11s/it]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped 1 full traces after 1 examples for up to 1 rounds, amounting to 1 attempts.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3146876614a146569534ee1e0cef7f86","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 56.00 / 70 (80.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 70/70 [00:44&lt;00:00,  1.58it/s] </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/29 01:09:48 INFO dspy.evaluate.evaluate: Average Metric: 56.0 / 70 (80.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval_7 at: http://localhost:5000/#/experiments/3/runs/861f0c753b754e6a8eb3372287edd9bc
üß™ View experiment at: http://localhost:5000/#/experiments/3
New best score: 80.0 for seed 4
Scores so far: [74.29, 74.29, 74.29, 72.86, 74.29, 75.71, 75.71, 80.0]
Best score so far: 80.0
8 candidate programs found.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"36e21760751a482c874fbc57b485e178","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>üèÉ View run bootstrap_few_shot_rs_openai_o3-2025-04-16 at: http://localhost:5000/#/experiments/3/runs/8576b067ea60468ebc37cda1a17be1dc
üß™ View experiment at: http://localhost:5000/#/experiments/3
üèÉ View run bootstrap_few_shot_rs_easy at: http://localhost:5000/#/experiments/3/runs/b5f08a070a634f74888fb8c42f24bfa3
üß™ View experiment at: http://localhost:5000/#/experiments/3</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>
  <style scoped>
  button {
    border: none;
    border-radius: 4px;
    background-color: rgb(34, 114, 180);
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial;
    font-size: 13px;
    color: white;
    margin-top: 8px;
    margin-bottom: 8px;
    padding: 8px 16px;
    cursor: pointer;
  }
  button:hover {
    background-color: rgb(66, 153, 224);
  }
  </style>
  <button
    onclick="
        const display = this.nextElementSibling.style.display;
        const isCollapsed = display === 'none';
        this.nextElementSibling.style.display = isCollapsed ? null : 'none';

        const verb = isCollapsed ? 'Collapse' : 'Expand';
        this.innerText = `${verb} MLflow Trace`;
    "
  >Collapse MLflow Trace</button>
  <iframe
    id="trace-renderer"
    style="width: 100%; height: 500px; border: none; resize: vertical;"
    src="http://localhost:5000/static-files/lib/notebook-trace-renderer/index.html?trace_id=bc6ccffd18824246934194a85933d3fd&amp;experiment_id=3&amp;trace_id=e37a0ba10d0543bb908e397933697d6d&amp;experiment_id=3&amp;trace_id=b37797a381b44f7eb13e1f42eca0567c&amp;experiment_id=3&amp;trace_id=9a18ced106784364ae12831ce45a8748&amp;experiment_id=3&amp;trace_id=3d7bb8edeb78492bac5473d6e52c4846&amp;experiment_id=3&amp;trace_id=d42d241ebb9e40b1affe006598cae983&amp;experiment_id=3&amp;trace_id=344ea0c049b946e8b780a9e02d720688&amp;experiment_id=3&amp;trace_id=4cac19ef64574b50b38d4baf81b360d5&amp;experiment_id=3&amp;trace_id=c4ca77588233486e9d234e95aa976329&amp;experiment_id=3&amp;trace_id=c9921423c3aa4f16933885eb15242313&amp;experiment_id=3&amp;version=3.1.4"
  />
</div>
</div>
</div>
<p>From the above, it looks like GPT-4.1 gives an score of 80% on the validation set, WITHOUT ANY PROMPT ENGINEERING/FEW-SHOT PROMPTING. This is great!</p>
<p>As mentioned earlier, due to cost and time constraints, we want to first narrow down the list of models we want to test on the harder stages.</p>
<p>As a recap, our implementation strategy here will be as follows: instead of just using the performance of the models on the ‚Äúeasy‚Äù validation set, we will use a combination of two datasets:</p>
<ol type="1">
<li>Gate - 50 Easy dialogs, teacher - forced. Drop model if Turn-EM &lt; 0.55.</li>
<li>Probe - 30-dialog mixed micro-set (15 Medium + 15 Hard, closed loop). Keep model only if Final-Turn EM ‚â• 0.35, Dialogue-mean EM ‚â• 0.35</li>
</ol>
<p>We will now create our ‚Äúgate‚Äù and ‚Äúprobe‚Äù datasets.</p>
<div id="cell-33" class="cell" data-execution_count="420">
<div class="sourceCode" id="cb188"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>gate_ids <span class="op">=</span> easy_valid_ids.sample(<span class="dv">50</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>probe_medium_ids <span class="op">=</span> medium_valid_ids.sample(<span class="dv">15</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>probe_hard_ids <span class="op">=</span> hard_valid_ids.sample(<span class="dv">30</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>gate_df <span class="op">=</span> easy_valid_df[easy_valid_df[<span class="st">&quot;id&quot;</span>].isin(gate_ids[<span class="st">&quot;id&quot;</span>])].copy()</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>probe_df <span class="op">=</span> pd.concat(</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>        medium_valid_df[medium_valid_df[<span class="st">&quot;id&quot;</span>].isin(probe_medium_ids[<span class="st">&quot;id&quot;</span>])],</span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>        hard_valid_df[hard_valid_df[<span class="st">&quot;id&quot;</span>].isin(probe_hard_ids[<span class="st">&quot;id&quot;</span>])],</span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>).copy()</span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> gate_df.shape[<span class="dv">0</span>] <span class="op">==</span> gate_ids.shape[<span class="dv">0</span>]</span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> probe_df.shape[<span class="dv">0</span>] <span class="op">==</span> probe_medium_ids.shape[<span class="dv">0</span>] <span class="op">+</span> probe_hard_ids.shape[<span class="dv">0</span>]</span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>gate_examples <span class="op">=</span> to_turn_examples(gate_df, history_mode<span class="op">=</span><span class="st">&quot;teacher&quot;</span>)</span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a>probe_examples <span class="op">=</span> to_turn_examples(probe_df, history_mode<span class="op">=</span><span class="st">&quot;teacher&quot;</span>)</span></code></pre></div>
</div>
<p>We will also save the <code>gate</code> and <code>probe</code> dataset ids, to compare performance of different models on them.</p>
<div id="cell-35" class="cell" data-execution_count="500">
<div class="sourceCode" id="cb189"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(<span class="st">&quot;validation_datasets&quot;</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>gate_ids.to_json(<span class="st">&quot;validation_datasets/gate_ids.jsonl&quot;</span>, orient<span class="op">=</span><span class="st">&quot;records&quot;</span>, lines<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>probe_medium_ids.to_json(</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;validation_datasets/probe_medium_ids.jsonl&quot;</span>, orient<span class="op">=</span><span class="st">&quot;records&quot;</span>, lines<span class="op">=</span><span class="va">True</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>probe_hard_ids.to_json(</span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;validation_datasets/probe_hard_ids.jsonl&quot;</span>, orient<span class="op">=</span><span class="st">&quot;records&quot;</span>, lines<span class="op">=</span><span class="va">True</span></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="cell-36" class="cell" data-execution_count="421">
<div class="sourceCode" id="cb190"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>gate_examples[<span class="dv">0</span>].toDict()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="421">
<pre><code>{&#39;conversation_context&#39;: &#39;None&#39;,
 &#39;evidence_snippets&#39;: &quot;[PRE]\nentergy corporation and subsidiaries management&#39;s financial discussion and analysis refer to 201cselected financial data - five-year comparison of entergy corporation and subsidiaries 201d which accompanies entergy corporation 2019s financial statements in this report for further information with respect to operating statistics . in november 2007 the board approved a plan to pursue a separation of entergy 2019s non-utility nuclear business from entergy through a spin-off of the business to entergy shareholders . in april 2010 , entergy announced that it planned to unwind the business infrastructure associated with the proposed spin-off transaction . as a result of the plan to unwind the business infrastructure , entergy recorded expenses in 2010 for the write-off of certain capitalized costs incurred in connection with the planned spin-off transaction . these costs are discussed in more detail below and throughout this section . net revenue utility following is an analysis of the change in net revenue comparing 2010 to 2009 . amount ( in millions ) .\n[/PRE]\n[POST]\nthe volume/weather variance is primarily due to an increase of 8362 gwh , or 8% ( 8 % ) , in billed electricity usage in all retail sectors , including the effect on the residential sector of colder weather in the first quarter 2010 compared to 2009 and warmer weather in the second and third quarters 2010 compared to 2009 . the industrial sector reflected strong sales growth on continuing signs of economic recovery . the improvement in this sector was primarily driven by inventory restocking and strong exports with the chemicals , refining , and miscellaneous manufacturing sectors leading the improvement . the retail electric price variance is primarily due to : increases in the formula rate plan riders at entergy gulf states louisiana effective november 2009 , january 2010 , and september 2010 , at entergy louisiana effective november 2009 , and at entergy mississippi effective july 2009 ; a base rate increase at entergy arkansas effective july 2010 ; rate actions at entergy texas , including base rate increases effective in may and august 2010 ; a formula rate plan provision of $ 16.6 million recorded in the third quarter 2009 for refunds that were made to customers in accordance with settlements approved by the lpsc ; and the recovery in 2009 by entergy arkansas of 2008 extraordinary storm costs , as approved by the apsc , which ceased in january 2010 . the recovery of storm costs is offset in other operation and maintenance expenses . see note 2 to the financial statements for further discussion of the proceedings referred to above. .\n[/POST]&quot;,
 &#39;table&#39;: &#39;| Row | 2009 net revenue | volume/weather | retail electric price | provision for regulatory proceedings | rough production cost equalization | ano decommissioning trust | fuel recovery | other | 2010 net revenue |\n|---|---|---|---|---|---|---|---|---|---|\n| amount ( in millions ) | 4694.0 | 231.0 | 137.0 | 26.0 | 19.0 | -24.0 | -44.0 | 12.0 | 5051.0 |&#39;,
 &#39;question&#39;: &#39;what was the difference in net revenue between 2009 and 2010?&#39;,
 &#39;id&#39;: &#39;Single_ETR/2011/page_22.pdf-3&#39;,
 &#39;doc_pre_text&#39;: &quot;entergy corporation and subsidiaries management&#39;s financial discussion and analysis refer to 201cselected financial data - five-year comparison of entergy corporation and subsidiaries 201d which accompanies entergy corporation 2019s financial statements in this report for further information with respect to operating statistics . in november 2007 the board approved a plan to pursue a separation of entergy 2019s non-utility nuclear business from entergy through a spin-off of the business to entergy shareholders . in april 2010 , entergy announced that it planned to unwind the business infrastructure associated with the proposed spin-off transaction . as a result of the plan to unwind the business infrastructure , entergy recorded expenses in 2010 for the write-off of certain capitalized costs incurred in connection with the planned spin-off transaction . these costs are discussed in more detail below and throughout this section . net revenue utility following is an analysis of the change in net revenue comparing 2010 to 2009 . amount ( in millions ) .&quot;,
 &#39;doc_post_text&#39;: &#39;the volume/weather variance is primarily due to an increase of 8362 gwh , or 8% ( 8 % ) , in billed electricity usage in all retail sectors , including the effect on the residential sector of colder weather in the first quarter 2010 compared to 2009 and warmer weather in the second and third quarters 2010 compared to 2009 . the industrial sector reflected strong sales growth on continuing signs of economic recovery . the improvement in this sector was primarily driven by inventory restocking and strong exports with the chemicals , refining , and miscellaneous manufacturing sectors leading the improvement . the retail electric price variance is primarily due to : increases in the formula rate plan riders at entergy gulf states louisiana effective november 2009 , january 2010 , and september 2010 , at entergy louisiana effective november 2009 , and at entergy mississippi effective july 2009 ; a base rate increase at entergy arkansas effective july 2010 ; rate actions at entergy texas , including base rate increases effective in may and august 2010 ; a formula rate plan provision of $ 16.6 million recorded in the third quarter 2009 for refunds that were made to customers in accordance with settlements approved by the lpsc ; and the recovery in 2009 by entergy arkansas of 2008 extraordinary storm costs , as approved by the apsc , which ceased in january 2010 . the recovery of storm costs is offset in other operation and maintenance expenses . see note 2 to the financial statements for further discussion of the proceedings referred to above. .&#39;,
 &#39;doc_table&#39;: {&#39;amount ( in millions )&#39;: {&#39;2009 net revenue&#39;: 4694.0,
   &#39;volume/weather&#39;: 231.0,
   &#39;retail electric price&#39;: 137.0,
   &#39;provision for regulatory proceedings&#39;: 26.0,
   &#39;rough production cost equalization&#39;: 19.0,
   &#39;ano decommissioning trust&#39;: -24.0,
   &#39;fuel recovery&#39;: -44.0,
   &#39;other&#39;: 12.0,
   &#39;2010 net revenue&#39;: 5051.0}},
 &#39;dialogue_conv_questions&#39;: [&#39;what was the difference in net revenue between 2009 and 2010?&#39;,
  &#39;and the specific value for 2009 again?&#39;,
  &#39;so what was the percentage change during this time?&#39;],
 &#39;dialogue_conv_answers&#39;: [&#39;357&#39;, &#39;4694&#39;, &#39;7.61%&#39;],
 &#39;dialogue_turn_program&#39;: [&#39;subtract(5051, 4694)&#39;,
  &#39;4694&#39;,
  &#39;subtract(5051, 4694), divide(#0, 4694)&#39;],
 &#39;dialogue_executed_answers&#39;: [357.0, 4694.0, 0.07605],
 &#39;dialogue_qa_split&#39;: [False, False, False],
 &#39;features_num_dialogue_turns&#39;: 3,
 &#39;features_has_type2_question&#39;: False,
 &#39;features_has_duplicate_columns&#39;: False,
 &#39;features_has_non_numeric_values&#39;: False,
 &#39;answer&#39;: 357.0}</code></pre>
</div>
</div>
<div id="cell-37" class="cell" data-execution_count="422">
<div class="sourceCode" id="cb192"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>gate_examples[<span class="dv">0</span>].inputs().toDict()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="422">
<pre><code>{&#39;conversation_context&#39;: &#39;None&#39;,
 &#39;evidence_snippets&#39;: &quot;[PRE]\nentergy corporation and subsidiaries management&#39;s financial discussion and analysis refer to 201cselected financial data - five-year comparison of entergy corporation and subsidiaries 201d which accompanies entergy corporation 2019s financial statements in this report for further information with respect to operating statistics . in november 2007 the board approved a plan to pursue a separation of entergy 2019s non-utility nuclear business from entergy through a spin-off of the business to entergy shareholders . in april 2010 , entergy announced that it planned to unwind the business infrastructure associated with the proposed spin-off transaction . as a result of the plan to unwind the business infrastructure , entergy recorded expenses in 2010 for the write-off of certain capitalized costs incurred in connection with the planned spin-off transaction . these costs are discussed in more detail below and throughout this section . net revenue utility following is an analysis of the change in net revenue comparing 2010 to 2009 . amount ( in millions ) .\n[/PRE]\n[POST]\nthe volume/weather variance is primarily due to an increase of 8362 gwh , or 8% ( 8 % ) , in billed electricity usage in all retail sectors , including the effect on the residential sector of colder weather in the first quarter 2010 compared to 2009 and warmer weather in the second and third quarters 2010 compared to 2009 . the industrial sector reflected strong sales growth on continuing signs of economic recovery . the improvement in this sector was primarily driven by inventory restocking and strong exports with the chemicals , refining , and miscellaneous manufacturing sectors leading the improvement . the retail electric price variance is primarily due to : increases in the formula rate plan riders at entergy gulf states louisiana effective november 2009 , january 2010 , and september 2010 , at entergy louisiana effective november 2009 , and at entergy mississippi effective july 2009 ; a base rate increase at entergy arkansas effective july 2010 ; rate actions at entergy texas , including base rate increases effective in may and august 2010 ; a formula rate plan provision of $ 16.6 million recorded in the third quarter 2009 for refunds that were made to customers in accordance with settlements approved by the lpsc ; and the recovery in 2009 by entergy arkansas of 2008 extraordinary storm costs , as approved by the apsc , which ceased in january 2010 . the recovery of storm costs is offset in other operation and maintenance expenses . see note 2 to the financial statements for further discussion of the proceedings referred to above. .\n[/POST]&quot;,
 &#39;table&#39;: &#39;| Row | 2009 net revenue | volume/weather | retail electric price | provision for regulatory proceedings | rough production cost equalization | ano decommissioning trust | fuel recovery | other | 2010 net revenue |\n|---|---|---|---|---|---|---|---|---|---|\n| amount ( in millions ) | 4694.0 | 231.0 | 137.0 | 26.0 | 19.0 | -24.0 | -44.0 | 12.0 | 5051.0 |&#39;,
 &#39;question&#39;: &#39;what was the difference in net revenue between 2009 and 2010?&#39;}</code></pre>
</div>
</div>
<section id="gate-dataset-results" class="level3">
<h3>Gate Dataset Results</h3>
<div id="cell-39" class="cell" data-execution_count="423">
<div class="sourceCode" id="cb194"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dspy.evaluate <span class="im">import</span> Evaluate</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> mlflow.start_run(run_name<span class="op">=</span><span class="st">&quot;gate_dataset_results&quot;</span>) <span class="im">as</span> parent_ctx:</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> candidate_lm <span class="kw">in</span> llms:</span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>        run_name <span class="op">=</span> <span class="ss">f&quot;gate_</span><span class="sc">{</span>candidate_lm<span class="sc">.</span>model<span class="sc">.</span>replace(<span class="st">&#39;/&#39;</span>, <span class="st">&#39;_&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>        sanitized_run_name <span class="op">=</span> re.sub(<span class="vs">r&quot;</span><span class="pp">[^a-zA-Z0-9_</span><span class="ch">\-</span><span class="pp">]</span><span class="vs">&quot;</span>, <span class="st">&quot;_&quot;</span>, run_name)</span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> mlflow.start_run(run_name<span class="op">=</span>sanitized_run_name, nested<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a>            current_evaluator <span class="op">=</span> Evaluate(</span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a>                devset<span class="op">=</span>gate_examples[:<span class="dv">10</span>],</span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a>                num_threads<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a>                display_progress<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a>                <span class="co"># display_table=True,</span></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a>                <span class="co"># provide_traceback=True,</span></span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a>                return_all_scores<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a>                return_outputs<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> dspy.context(lm<span class="op">=</span>candidate_lm) <span class="im">as</span> ctx:</span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a>                current_result <span class="op">=</span> current_evaluator(</span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a>                    TurnSolver(reasoning_lm<span class="op">=</span><span class="va">True</span>), metric<span class="op">=</span>turn_em_metric</span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb194-25"><a href="#cb194-25" aria-hidden="true" tabindex="-1"></a>                results.append(current_result)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 8.00 / 10 (80.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:00&lt;00:00, 65.65it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:19:36 INFO dspy.evaluate.evaluate: Average Metric: 8.0 / 10 (80.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/502b5457f9db44339a5afce34d13d847
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_openai_gpt-4_1-2025-04-14 at: http://localhost:5000/#/experiments/1/runs/7e61e1f47f4e408c8cec59ee1bf9c0dd
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 5.00 / 10 (50.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:00&lt;00:00, 58.97it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:19:37 INFO dspy.evaluate.evaluate: Average Metric: 5.0 / 10 (50.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/1b4ea94ac47e4660b30234d6ad78c8d8
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_openai_gpt-4_1-mini-2025-04-14 at: http://localhost:5000/#/experiments/1/runs/fa03278692c848e996a3e43e6422099f
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 6.00 / 10 (60.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:00&lt;00:00, 79.01it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:19:37 INFO dspy.evaluate.evaluate: Average Metric: 6.0 / 10 (60.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/ce1366eaa8c146eabba86650fae12f74
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_openai_o4-mini-2025-04-16 at: http://localhost:5000/#/experiments/1/runs/3d1fb9c72b914d5a942312db0a6a5088
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 6.00 / 10 (60.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:00&lt;00:00, 81.33it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:19:37 INFO dspy.evaluate.evaluate: Average Metric: 6.0 / 10 (60.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/9e00a96bfd114bbaa9e47dcb478b4423
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_anthropic_claude-sonnet-4-20250514 at: http://localhost:5000/#/experiments/1/runs/76c2180b1f3c4510ab13158d3b0d36eb
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 7.00 / 10 (70.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:00&lt;00:00, 65.50it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:19:37 INFO dspy.evaluate.evaluate: Average Metric: 7.0 / 10 (70.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/4a3c7957aaab4a4e972b06a7754fe6d4
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_gemini_gemini-2_5-flash at: http://localhost:5000/#/experiments/1/runs/aa191551b2844b57bb9d2db37e50c4f0
üß™ View experiment at: http://localhost:5000/#/experiments/1
  0%|          | 0/10 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:19:37 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:19:37 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 7.00 / 10 (70.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:00&lt;00:00, 61.55it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:19:38 INFO dspy.evaluate.evaluate: Average Metric: 7.0 / 10 (70.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/809ee64fbd164475b3592ff2340b2595
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_gemini_gemini-2_5-flash-lite at: http://localhost:5000/#/experiments/1/runs/90ea53b2a2484cc0a5302b7c8245184e
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 8.00 / 10 (80.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:00&lt;00:00, 74.80it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:19:38 INFO dspy.evaluate.evaluate: Average Metric: 8.0 / 10 (80.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/6f1bec87d6ce4137b10e055e94bf54d4
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_openai_o3-2025-04-16 at: http://localhost:5000/#/experiments/1/runs/7e4f8e42c8244b94af37787cacd12ee5
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 7.00 / 10 (70.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:00&lt;00:00, 86.48it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:19:38 INFO dspy.evaluate.evaluate: Average Metric: 7.0 / 10 (70.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/ab105090285e4b55a93205dc6f1bde64
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_anthropic_claude-opus-4-20250514 at: http://localhost:5000/#/experiments/1/runs/58c90aae89644af8a1d2c7dc845b0c07
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 8.00 / 10 (80.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:00&lt;00:00, 39.63it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:19:38 INFO dspy.evaluate.evaluate: Average Metric: 8.0 / 10 (80.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/e786a0b633844e7ebdb6a165561b81ec
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_gemini_gemini-2_5-pro at: http://localhost:5000/#/experiments/1/runs/9e1f42bcc8064a9383ed590c1add4d01
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 7.00 / 10 (70.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:00&lt;00:00, 71.29it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:19:39 INFO dspy.evaluate.evaluate: Average Metric: 7.0 / 10 (70.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/f4ae2cb32a2b401aa5ab8f7b02dc7b86
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_ollama_qwen3_32b at: http://localhost:5000/#/experiments/1/runs/ca6c0d988ca94f2998eb08f339fdf22a
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_dataset_results at: http://localhost:5000/#/experiments/1/runs/0b0e82f0b3724ec1afedde0d7a036dfe
üß™ View experiment at: http://localhost:5000/#/experiments/1</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>
  <style scoped>
  button {
    border: none;
    border-radius: 4px;
    background-color: rgb(34, 114, 180);
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial;
    font-size: 13px;
    color: white;
    margin-top: 8px;
    margin-bottom: 8px;
    padding: 8px 16px;
    cursor: pointer;
  }
  button:hover {
    background-color: rgb(66, 153, 224);
  }
  </style>
  <button
    onclick="
        const display = this.nextElementSibling.style.display;
        const isCollapsed = display === 'none';
        this.nextElementSibling.style.display = isCollapsed ? null : 'none';

        const verb = isCollapsed ? 'Collapse' : 'Expand';
        this.innerText = `${verb} MLflow Trace`;
    "
  >Collapse MLflow Trace</button>
  <iframe
    id="trace-renderer"
    style="width: 100%; height: 500px; border: none; resize: vertical;"
    src="http://localhost:5000/static-files/lib/notebook-trace-renderer/index.html?trace_id=9f5fdac684c74647a0a88cbdcd16d89b&amp;experiment_id=1&amp;trace_id=3de6592234f74ca4ba6a450f2a01b37a&amp;experiment_id=1&amp;trace_id=31e022f38c354840b5abbe64b417306d&amp;experiment_id=1&amp;trace_id=0756d03769c4417e861f7171ecb7bcb8&amp;experiment_id=1&amp;trace_id=f1dcee538d454f96a41dc1d59c3a27f9&amp;experiment_id=1&amp;trace_id=283f1f0436c24afabdb9d865b3c0e802&amp;experiment_id=1&amp;trace_id=ddb2286507bd47fd8580b5e8dd923d7e&amp;experiment_id=1&amp;trace_id=427f384f2d604830844675df25de1226&amp;experiment_id=1&amp;trace_id=789bab02c70346c1a50c91de5f67376b&amp;experiment_id=1&amp;trace_id=2c112f9efbb44a9796a0ca64a43b8b5d&amp;experiment_id=1&amp;version=3.1.4"
  />
</div>
</div>
</div>
<div id="cell-40" class="cell" data-execution_count="424">
<div class="sourceCode" id="cb218"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&quot;LLM&quot;</span>: llms[idx].model, <span class="st">&quot;Evaluation Score&quot;</span>: candidate[<span class="dv">0</span>]}</span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, candidate <span class="kw">in</span> <span class="bu">enumerate</span>(results)</span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                  LLM  Evaluation Score
0           openai/gpt-4.1-2025-04-14              80.0
1      openai/gpt-4.1-mini-2025-04-14              50.0
2           openai/o4-mini-2025-04-16              60.0
3  anthropic/claude-sonnet-4-20250514              60.0
4             gemini/gemini-2.5-flash              70.0
5        gemini/gemini-2.5-flash-lite              70.0
6                openai/o3-2025-04-16              80.0
7    anthropic/claude-opus-4-20250514              70.0
8               gemini/gemini-2.5-pro              80.0
9                    ollama/qwen3:32b              70.0</code></pre>
</div>
</div>
<p>From the small test above, we see that most of the models score in a similar range. I think it‚Äôs expected that GPT-4.1-mini performs poorly, given that it‚Äôs a much smaller model compared to all the competetiors.</p>
<p>From the MLFlow logs, we also see that while Qwen3:32b has a relatively high score, inference is quite slow. For now, we will skip this model during the model selection phase, and revisit it later.</p>
<div id="cell-42" class="cell" data-execution_count="425">
<div class="sourceCode" id="cb220"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>model_selection_llms <span class="op">=</span> [</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>    lm_oai_gpt_4_1,</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>    lm_oai_gpt_4_1_mini,</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>    lm_oai_o4_mini,</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>    lm_anthropic_sonnet_4_0,</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>    lm_gemini_flash_2_5,</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>    lm_gemini_flash_2_5_lite,</span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>    lm_oai_o3,</span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>    lm_anthropic_opus_4_0,</span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a>    lm_gemini_pro_2_5,</span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
</div>
<div id="cell-43" class="cell" data-execution_count="426">
<div class="sourceCode" id="cb221"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dspy.evaluate <span class="im">import</span> Evaluate</span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> mlflow.start_run(run_name<span class="op">=</span><span class="st">&quot;gate_dataset_results_full&quot;</span>) <span class="im">as</span> parent_ctx:</span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> candidate_lm <span class="kw">in</span> model_selection_llms:</span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>        run_name <span class="op">=</span> <span class="ss">f&quot;gate_</span><span class="sc">{</span>candidate_lm<span class="sc">.</span>model<span class="sc">.</span>replace(<span class="st">&#39;/&#39;</span>, <span class="st">&#39;_&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a>        sanitized_run_name <span class="op">=</span> re.sub(<span class="vs">r&quot;</span><span class="pp">[^a-zA-Z0-9_</span><span class="ch">\-</span><span class="pp">]</span><span class="vs">&quot;</span>, <span class="st">&quot;_&quot;</span>, run_name)</span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> mlflow.start_run(run_name<span class="op">=</span>sanitized_run_name, nested<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>            current_evaluator <span class="op">=</span> Evaluate(</span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>                devset<span class="op">=</span>gate_examples,</span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>                num_threads<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a>                display_progress<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a>                <span class="co"># display_table=True,</span></span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a>                <span class="co"># provide_traceback=True,</span></span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a>                return_all_scores<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a>                return_outputs<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb221-20"><a href="#cb221-20" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb221-21"><a href="#cb221-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> dspy.context(lm<span class="op">=</span>candidate_lm) <span class="im">as</span> ctx:</span>
<span id="cb221-22"><a href="#cb221-22" aria-hidden="true" tabindex="-1"></a>                current_result <span class="op">=</span> current_evaluator(</span>
<span id="cb221-23"><a href="#cb221-23" aria-hidden="true" tabindex="-1"></a>                    TurnSolver(reasoning_lm<span class="op">=</span><span class="va">True</span>), metric<span class="op">=</span>turn_em_metric</span>
<span id="cb221-24"><a href="#cb221-24" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb221-25"><a href="#cb221-25" aria-hidden="true" tabindex="-1"></a>                results.append(current_result)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 95.00 / 151 (62.9%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 151/151 [00:02&lt;00:00, 74.97it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:32 INFO dspy.evaluate.evaluate: Average Metric: 95.0 / 151 (62.9%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/e18f45df89fb4a0e9e98e6f01d74bf71
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_openai_gpt-4_1-2025-04-14 at: http://localhost:5000/#/experiments/1/runs/f15c1d3760fc489b95ec5950f3e992b9
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 81.00 / 151 (53.6%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 151/151 [00:02&lt;00:00, 74.18it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:34 INFO dspy.evaluate.evaluate: Average Metric: 81.0 / 151 (53.6%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/9f40a5f2dc2a4e09977f8b8c53822605
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_openai_gpt-4_1-mini-2025-04-14 at: http://localhost:5000/#/experiments/1/runs/c882d7c82d5f4a3abb510bf57d506c53
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 31.00 / 55 (56.4%):  36%|‚ñà‚ñà‚ñà‚ñå      | 54/151 [00:00&lt;00:01, 53.34it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:35 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 44.00 / 72 (61.1%):  47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 71/151 [00:01&lt;00:01, 73.76it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:35 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 62.00 / 106 (58.5%):  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 105/151 [00:01&lt;00:00, 82.16it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:36 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 95.00 / 151 (62.9%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 151/151 [00:02&lt;00:00, 71.71it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:36 INFO dspy.evaluate.evaluate: Average Metric: 95.0 / 151 (62.9%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/8154049643d040d39c7642b56ac6d7c5
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_openai_o4-mini-2025-04-16 at: http://localhost:5000/#/experiments/1/runs/938b45e4b5204804b4e4660feebf563a
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 95.00 / 151 (62.9%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 151/151 [00:02&lt;00:00, 70.44it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:38 INFO dspy.evaluate.evaluate: Average Metric: 95.0 / 151 (62.9%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/599e8c7040b04b8c8f0ca24c6dc94d37
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_anthropic_claude-sonnet-4-20250514 at: http://localhost:5000/#/experiments/1/runs/4442e20dc743456b966821c18219c23e
üß™ View experiment at: http://localhost:5000/#/experiments/1
  0%|          | 0/151 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:39 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 18:21:39 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 31.00 / 47 (66.0%):  30%|‚ñà‚ñà‚ñà       | 46/151 [00:01&lt;00:02, 47.10it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:40 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 57.00 / 93 (61.3%):  62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 93/151 [00:01&lt;00:00, 79.96it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:40 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 73.00 / 122 (59.8%):  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 121/151 [00:01&lt;00:00, 89.94it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:40 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 96.00 / 151 (63.6%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 151/151 [00:02&lt;00:00, 67.06it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:41 INFO dspy.evaluate.evaluate: Average Metric: 96.0 / 151 (63.6%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/bcea3ffb8c6f4cbb98725e43e88cbdd0
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_gemini_gemini-2_5-flash at: http://localhost:5000/#/experiments/1/runs/7db59c48c06c4948adf754477705c360
üß™ View experiment at: http://localhost:5000/#/experiments/1
  0%|          | 0/151 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:41 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:41 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:41 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:41 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 18:21:41 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 18:21:41 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:41 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 18:21:41 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 18:21:41 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:41 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 8.00 / 12 (66.7%):   7%|‚ñã         | 11/151 [00:00&lt;00:03, 38.23it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:41 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:41 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 9.00 / 13 (69.2%):   8%|‚ñä         | 12/151 [00:00&lt;00:03, 38.23it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:41 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:41 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 18.00 / 29 (62.1%):  19%|‚ñà‚ñâ        | 29/151 [00:00&lt;00:01, 62.69it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:42 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:42 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 20.00 / 32 (62.5%):  21%|‚ñà‚ñà        | 31/151 [00:00&lt;00:01, 62.69it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:42 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 20.00 / 33 (60.6%):  21%|‚ñà‚ñà        | 32/151 [00:00&lt;00:01, 62.69it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:42 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 18:21:42 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 21.00 / 34 (61.8%):  22%|‚ñà‚ñà‚ñè       | 33/151 [00:00&lt;00:01, 62.69it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:42 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 22.00 / 38 (57.9%):  25%|‚ñà‚ñà‚ñç       | 37/151 [00:00&lt;00:01, 61.42it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:42 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:42 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 44.00 / 75 (58.7%):  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 74/151 [00:01&lt;00:01, 57.41it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:42 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 44.00 / 76 (57.9%):  50%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 75/151 [00:01&lt;00:01, 57.41it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:42 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 44.00 / 78 (56.4%):  51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 77/151 [00:01&lt;00:01, 58.30it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:42 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 47.00 / 84 (56.0%):  56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 84/151 [00:01&lt;00:01, 60.44it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:42 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:42 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 51.00 / 89 (57.3%):  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 88/151 [00:01&lt;00:01, 60.44it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:43 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:43 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:43 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 52.00 / 90 (57.8%):  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 89/151 [00:01&lt;00:01, 60.44it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:43 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 55.00 / 96 (57.3%):  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 95/151 [00:01&lt;00:00, 60.62it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:43 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 56.00 / 97 (57.7%):  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 96/151 [00:01&lt;00:00, 60.62it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:43 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 59.00 / 107 (55.1%):  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 106/151 [00:01&lt;00:00, 67.41it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:43 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 59.00 / 108 (54.6%):  72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 108/151 [00:01&lt;00:00, 69.63it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:43 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 62.00 / 112 (55.4%):  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 111/151 [00:01&lt;00:00, 69.63it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:43 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:43 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 69.00 / 123 (56.1%):  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 122/151 [00:01&lt;00:00, 69.40it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:43 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:21:43 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 87.00 / 151 (57.6%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 151/151 [00:02&lt;00:00, 60.17it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:43 INFO dspy.evaluate.evaluate: Average Metric: 87.0 / 151 (57.6%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/c348c68458124441865ac735d0b7d641
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_gemini_gemini-2_5-flash-lite at: http://localhost:5000/#/experiments/1/runs/598582fb690540e7baca55a097fee220
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 22.00 / 32 (68.8%):  21%|‚ñà‚ñà        | 31/151 [00:00&lt;00:01, 64.25it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:44 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 69.00 / 100 (69.0%):  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 99/151 [00:01&lt;00:00, 62.91it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:45 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 106.00 / 151 (70.2%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 151/151 [00:02&lt;00:00, 51.93it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:47 INFO dspy.evaluate.evaluate: Average Metric: 106.0 / 151 (70.2%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/853504669f224faf8773cf2d9436fb41
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_openai_o3-2025-04-16 at: http://localhost:5000/#/experiments/1/runs/f122d81f9c1d46d582ce64553f6ee3ea
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 103.00 / 151 (68.2%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 151/151 [00:02&lt;00:00, 67.19it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:49 INFO dspy.evaluate.evaluate: Average Metric: 103.0 / 151 (68.2%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/96826db5718c45d6a2dc0b2c5526441e
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_anthropic_claude-opus-4-20250514 at: http://localhost:5000/#/experiments/1/runs/d329de90de1e40e0b467681f0442656a
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 103.00 / 151 (68.2%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 151/151 [00:02&lt;00:00, 71.07it/s] </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:21:51 INFO dspy.evaluate.evaluate: Average Metric: 103.0 / 151 (68.2%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/1fbbc1c758204d438fd050d77d524632
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_gemini_gemini-2_5-pro at: http://localhost:5000/#/experiments/1/runs/6e2dd13cb21f455c905159caa8335678
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run gate_dataset_results_full at: http://localhost:5000/#/experiments/1/runs/51176a64c2af4fbc803a1e1f0775e924
üß™ View experiment at: http://localhost:5000/#/experiments/1</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>
  <style scoped>
  button {
    border: none;
    border-radius: 4px;
    background-color: rgb(34, 114, 180);
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial;
    font-size: 13px;
    color: white;
    margin-top: 8px;
    margin-bottom: 8px;
    padding: 8px 16px;
    cursor: pointer;
  }
  button:hover {
    background-color: rgb(66, 153, 224);
  }
  </style>
  <button
    onclick="
        const display = this.nextElementSibling.style.display;
        const isCollapsed = display === 'none';
        this.nextElementSibling.style.display = isCollapsed ? null : 'none';

        const verb = isCollapsed ? 'Collapse' : 'Expand';
        this.innerText = `${verb} MLflow Trace`;
    "
  >Collapse MLflow Trace</button>
  <iframe
    id="trace-renderer"
    style="width: 100%; height: 500px; border: none; resize: vertical;"
    src="http://localhost:5000/static-files/lib/notebook-trace-renderer/index.html?trace_id=5276eb031180473cb92d03ceca489d38&amp;experiment_id=1&amp;trace_id=0f2dffe6dfd74fe3b5697a0bffb47658&amp;experiment_id=1&amp;trace_id=35c112a62c334012a612cdca116e9b09&amp;experiment_id=1&amp;trace_id=e30a2c51605b4102b190affb869475f4&amp;experiment_id=1&amp;trace_id=1b74fe5cb6c8453b82c227eb63e11221&amp;experiment_id=1&amp;trace_id=5310ed582ac0431382787b65f63de317&amp;experiment_id=1&amp;trace_id=f713426ecd20413ba2acbb7af0228b2d&amp;experiment_id=1&amp;trace_id=0f44b811a42c41dd9d867b5e12f80044&amp;experiment_id=1&amp;trace_id=543c31429f2d4d7cb4d2284daf66b3f9&amp;experiment_id=1&amp;trace_id=d624a05b74cc43a0a69bc8b400465a69&amp;experiment_id=1&amp;version=3.1.4"
  />
</div>
</div>
</div>
<p>We will now run the evaluation suite over the entire <code>gate dataset</code> for all the models in the above list.</p>
<div id="cell-45" class="cell" data-execution_count="427">
<div class="sourceCode" id="cb299"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>tdf <span class="op">=</span> pd.DataFrame(</span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&quot;LLM&quot;</span>: llms[idx].model, <span class="st">&quot;Evaluation Score&quot;</span>: candidate[<span class="dv">0</span>]}</span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, candidate <span class="kw">in</span> <span class="bu">enumerate</span>(results)</span>
<span id="cb299-7"><a href="#cb299-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb299-8"><a href="#cb299-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb299-9"><a href="#cb299-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tdf)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                  LLM  Evaluation Score
0           openai/gpt-4.1-2025-04-14             62.91
1      openai/gpt-4.1-mini-2025-04-14             53.64
2           openai/o4-mini-2025-04-16             62.91
3  anthropic/claude-sonnet-4-20250514             62.91
4             gemini/gemini-2.5-flash             63.58
5        gemini/gemini-2.5-flash-lite             57.62
6                openai/o3-2025-04-16             70.20
7    anthropic/claude-opus-4-20250514             68.21
8               gemini/gemini-2.5-pro             68.21</code></pre>
</div>
</div>
<p>From the above table, we see a few interesting things:</p>
<ul>
<li>By default, most of the <strong>reasoning</strong> models perform better on the ‚Äúgate‚Äù dataset, with OAI O3 performing the best with a score of 70.20%</li>
<li>Reasoning models from the remaining two frontier labs score the same i.e 68.21%</li>
<li>We also see that the smaller reasoning models perform similar across the labs, with an average score of 63.58%, but at a <strong>significantly lower cost</strong>.</li>
<li>The outputs from sonnet-4 failed the structured output test, but this could be fixed using the DSPy TypingPredictor in the future. More on this later!</li>
<li>Finally, while a <em>non-reasoning</em> model like GPT-4.1 performs as well as the small reasoning models, the price of input/outputs tokens for GPT-4.1 is significantly higher compared to it‚Äôs counterparts.</li>
</ul>
<p>We will also run the test over the ‚Äúprobe‚Äù dataset, before deciding our final list of LLMs based on the performance-to-cost ratio.</p>
</section>
<section id="probe-dataset-results" class="level3">
<h3>Probe Dataset Results</h3>
<div id="cell-48" class="cell" data-execution_count="428">
<div class="sourceCode" id="cb301"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dspy.evaluate <span class="im">import</span> Evaluate</span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>probe_results <span class="op">=</span> []</span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> mlflow.start_run(run_name<span class="op">=</span><span class="st">&quot;probe_dataset_results_full&quot;</span>) <span class="im">as</span> parent_ctx:</span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> candidate_lm <span class="kw">in</span> model_selection_llms:</span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true" tabindex="-1"></a>        run_name <span class="op">=</span> <span class="ss">f&quot;probe_</span><span class="sc">{</span>candidate_lm<span class="sc">.</span>model<span class="sc">.</span>replace(<span class="st">&#39;/&#39;</span>, <span class="st">&#39;_&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb301-10"><a href="#cb301-10" aria-hidden="true" tabindex="-1"></a>        sanitized_run_name <span class="op">=</span> re.sub(<span class="vs">r&quot;</span><span class="pp">[^a-zA-Z0-9_</span><span class="ch">\-</span><span class="pp">]</span><span class="vs">&quot;</span>, <span class="st">&quot;_&quot;</span>, run_name)</span>
<span id="cb301-11"><a href="#cb301-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> mlflow.start_run(run_name<span class="op">=</span>sanitized_run_name, nested<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb301-12"><a href="#cb301-12" aria-hidden="true" tabindex="-1"></a>            current_evaluator <span class="op">=</span> Evaluate(</span>
<span id="cb301-13"><a href="#cb301-13" aria-hidden="true" tabindex="-1"></a>                devset<span class="op">=</span>probe_examples,</span>
<span id="cb301-14"><a href="#cb301-14" aria-hidden="true" tabindex="-1"></a>                num_threads<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb301-15"><a href="#cb301-15" aria-hidden="true" tabindex="-1"></a>                display_progress<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb301-16"><a href="#cb301-16" aria-hidden="true" tabindex="-1"></a>                <span class="co"># display_table=True,</span></span>
<span id="cb301-17"><a href="#cb301-17" aria-hidden="true" tabindex="-1"></a>                <span class="co"># provide_traceback=True,</span></span>
<span id="cb301-18"><a href="#cb301-18" aria-hidden="true" tabindex="-1"></a>                return_all_scores<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb301-19"><a href="#cb301-19" aria-hidden="true" tabindex="-1"></a>                return_outputs<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb301-20"><a href="#cb301-20" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb301-21"><a href="#cb301-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> dspy.context(lm<span class="op">=</span>candidate_lm) <span class="im">as</span> ctx:</span>
<span id="cb301-22"><a href="#cb301-22" aria-hidden="true" tabindex="-1"></a>                current_result <span class="op">=</span> current_evaluator(</span>
<span id="cb301-23"><a href="#cb301-23" aria-hidden="true" tabindex="-1"></a>                    TurnSolver(reasoning_lm<span class="op">=</span><span class="va">True</span>), metric<span class="op">=</span>turn_em_metric</span>
<span id="cb301-24"><a href="#cb301-24" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb301-25"><a href="#cb301-25" aria-hidden="true" tabindex="-1"></a>                probe_results.append(current_result)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 150.00 / 200 (75.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 200/200 [00:02&lt;00:00, 69.58it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:15 INFO dspy.evaluate.evaluate: Average Metric: 150.0 / 200 (75.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/6cccc46d61ae4365b9921586ed0ef193
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run probe_openai_gpt-4_1-2025-04-14 at: http://localhost:5000/#/experiments/1/runs/3b839cca27264ffaaace2643e23975c7
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 130.00 / 200 (65.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 200/200 [00:03&lt;00:00, 60.95it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:18 INFO dspy.evaluate.evaluate: Average Metric: 130.0 / 200 (65.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/8c371daf948343eb8a18370f1756a850
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run probe_openai_gpt-4_1-mini-2025-04-14 at: http://localhost:5000/#/experiments/1/runs/dcfce79bf36446929e2924273e0a2db5
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 79.00 / 102 (77.5%):  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 101/200 [00:02&lt;00:02, 36.80it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:20 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 122.00 / 157 (77.7%):  78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 156/200 [00:03&lt;00:00, 48.01it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:21 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 157.00 / 200 (78.5%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 200/200 [00:03&lt;00:00, 53.12it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:22 INFO dspy.evaluate.evaluate: Average Metric: 157.0 / 200 (78.5%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/758a3867a75541c2a3eab91ac6faf42b
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run probe_openai_o4-mini-2025-04-16 at: http://localhost:5000/#/experiments/1/runs/aafc2286d5ab4819aa467440328eed77
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 150.00 / 200 (75.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 200/200 [00:04&lt;00:00, 49.31it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:26 INFO dspy.evaluate.evaluate: Average Metric: 150.0 / 200 (75.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/3b6644b108a241f99e8dd0e2e1d051fa
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run probe_anthropic_claude-sonnet-4-20250514 at: http://localhost:5000/#/experiments/1/runs/3b4f42a464cd4e3496f4b1755decd7ce
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 24.00 / 31 (77.4%):  15%|‚ñà‚ñå        | 30/200 [00:00&lt;00:03, 50.11it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:27 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 148.00 / 200 (74.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 200/200 [00:03&lt;00:00, 51.35it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:30 INFO dspy.evaluate.evaluate: Average Metric: 148.0 / 200 (74.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/99af33e15c234269aa69333eebecb916
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run probe_gemini_gemini-2_5-flash at: http://localhost:5000/#/experiments/1/runs/7d11aa5ec28841adafa6b0e66733e13d
üß™ View experiment at: http://localhost:5000/#/experiments/1
  0%|          | 0/200 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:30 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:30 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 18:22:30 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:30 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 11.00 / 16 (68.8%):   8%|‚ñä         | 15/200 [00:00&lt;00:04, 41.77it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:31 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:31 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 18.00 / 24 (75.0%):  12%|‚ñà‚ñè        | 23/200 [00:00&lt;00:03, 50.59it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:31 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:31 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 19.00 / 26 (73.1%):  12%|‚ñà‚ñé        | 25/200 [00:00&lt;00:03, 50.59it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:31 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:31 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 21.00 / 31 (67.7%):  15%|‚ñà‚ñå        | 30/200 [00:00&lt;00:02, 58.14it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:31 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:31 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 22.00 / 33 (66.7%):  16%|‚ñà‚ñå        | 32/200 [00:00&lt;00:02, 58.14it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:31 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:31 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 27.00 / 42 (64.3%):  20%|‚ñà‚ñà        | 41/200 [00:01&lt;00:04, 33.61it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:31 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:31 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 32.00 / 53 (60.4%):  26%|‚ñà‚ñà‚ñå       | 52/200 [00:01&lt;00:03, 43.63it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:31 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:32 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 36.00 / 61 (59.0%):  30%|‚ñà‚ñà‚ñà       | 60/200 [00:01&lt;00:02, 49.53it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:32 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 18:22:32 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 39.00 / 65 (60.0%):  32%|‚ñà‚ñà‚ñà‚ñè      | 64/200 [00:01&lt;00:02, 60.32it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 39.00 / 66 (59.1%):  32%|‚ñà‚ñà‚ñà‚ñé      | 65/200 [00:01&lt;00:02, 60.32it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 41.00 / 68 (60.3%):  34%|‚ñà‚ñà‚ñà‚ñé      | 67/200 [00:01&lt;00:02, 60.32it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 18:22:32 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:32 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 54.00 / 84 (64.3%):  42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 83/200 [00:01&lt;00:01, 69.98it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 60.00 / 93 (64.5%):  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 92/200 [00:01&lt;00:01, 70.30it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:32 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 62.00 / 96 (64.6%):  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 95/200 [00:01&lt;00:01, 70.30it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 62.00 / 97 (63.9%):  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 96/200 [00:01&lt;00:01, 70.30it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 62.00 / 98 (63.3%):  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 98/200 [00:01&lt;00:01, 74.90it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 63.00 / 99 (63.6%):  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 98/200 [00:01&lt;00:01, 74.90it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 64.00 / 102 (62.7%):  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 101/200 [00:01&lt;00:01, 74.90it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 65.00 / 103 (63.1%):  51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 102/200 [00:01&lt;00:01, 74.90it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 73.00 / 115 (63.5%):  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 114/200 [00:02&lt;00:01, 56.16it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:32 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:32 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 76.00 / 119 (63.9%):  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 118/200 [00:02&lt;00:01, 56.16it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:33 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:33 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 78.00 / 123 (63.4%):  61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 122/200 [00:02&lt;00:01, 53.09it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:33 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:33 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 82.00 / 129 (63.6%):  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 128/200 [00:02&lt;00:01, 45.61it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:33 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:33 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 82.00 / 130 (63.1%):  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 129/200 [00:02&lt;00:01, 45.61it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:33 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:33 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 82.00 / 134 (61.2%):  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 133/200 [00:02&lt;00:01, 46.87it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:33 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 83.00 / 135 (61.5%):  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 134/200 [00:02&lt;00:01, 46.87it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:33 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 99.00 / 159 (62.3%):  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 159/200 [00:03&lt;00:00, 46.30it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:33 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.
2025/07/28 18:22:33 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 104.00 / 165 (63.0%):  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 164/200 [00:03&lt;00:01, 35.61it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:34 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 105.00 / 166 (63.3%):  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 165/200 [00:03&lt;00:00, 35.61it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:34 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 18:22:34 WARNING dspy.clients.lm: LM response was truncated due to exceeding max_tokens=20000. You can inspect the latest LM interactions with `dspy.inspect_history()`. To avoid truncation, consider passing a larger max_tokens when setting up dspy.LM. You may also consider increasing the temperature (currently 0.0)  if the reason for truncation is repetition.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 105.00 / 167 (62.9%):  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 166/200 [00:03&lt;00:00, 35.61it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:34 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 128.00 / 200 (64.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 200/200 [00:03&lt;00:00, 52.47it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:34 INFO dspy.evaluate.evaluate: Average Metric: 128.0 / 200 (64.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/20a1fa6983f349a0888cca2696bcae76
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run probe_gemini_gemini-2_5-flash-lite at: http://localhost:5000/#/experiments/1/runs/0c5ca9e2a1e84041b2937cd264727d94
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 48.00 / 61 (78.7%):  30%|‚ñà‚ñà‚ñà       | 60/200 [00:01&lt;00:03, 45.14it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:35 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 66.00 / 83 (79.5%):  41%|‚ñà‚ñà‚ñà‚ñà      | 82/200 [00:01&lt;00:01, 76.08it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:36 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Metric: 162.00 / 200 (81.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 200/200 [00:03&lt;00:00, 52.77it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:38 INFO dspy.evaluate.evaluate: Average Metric: 162.0 / 200 (81.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/513ceb4b58c44816894f0196c05f1d27
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run probe_openai_o3-2025-04-16 at: http://localhost:5000/#/experiments/1/runs/07039e1be0154904a14bf5b215b36bfb
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 160.00 / 200 (80.0%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 200/200 [00:04&lt;00:00, 46.05it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:22:43 INFO dspy.evaluate.evaluate: Average Metric: 160.0 / 200 (80.0%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/fa3840a6fc86489195ff4b93ba3525d3
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run probe_anthropic_claude-opus-4-20250514 at: http://localhost:5000/#/experiments/1/runs/242a848220a34df18fefcd752c6b1edf
üß™ View experiment at: http://localhost:5000/#/experiments/1
Average Metric: 157.00 / 200 (78.5%): 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 200/200 [00:20&lt;00:00,  9.94it/s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025/07/28 18:23:03 INFO dspy.evaluate.evaluate: Average Metric: 157.0 / 200 (78.5%)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
üèÉ View run eval at: http://localhost:5000/#/experiments/1/runs/28468bf07dea42438e3b2835cf8bd5d1
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run probe_gemini_gemini-2_5-pro at: http://localhost:5000/#/experiments/1/runs/b9decff973db41ce9863d93d41eff7c3
üß™ View experiment at: http://localhost:5000/#/experiments/1
üèÉ View run probe_dataset_results_full at: http://localhost:5000/#/experiments/1/runs/7f0b1ff0f4e94143b9fb5509ed6319be
üß™ View experiment at: http://localhost:5000/#/experiments/1</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>
  <style scoped>
  button {
    border: none;
    border-radius: 4px;
    background-color: rgb(34, 114, 180);
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial;
    font-size: 13px;
    color: white;
    margin-top: 8px;
    margin-bottom: 8px;
    padding: 8px 16px;
    cursor: pointer;
  }
  button:hover {
    background-color: rgb(66, 153, 224);
  }
  </style>
  <button
    onclick="
        const display = this.nextElementSibling.style.display;
        const isCollapsed = display === 'none';
        this.nextElementSibling.style.display = isCollapsed ? null : 'none';

        const verb = isCollapsed ? 'Collapse' : 'Expand';
        this.innerText = `${verb} MLflow Trace`;
    "
  >Collapse MLflow Trace</button>
  <iframe
    id="trace-renderer"
    style="width: 100%; height: 500px; border: none; resize: vertical;"
    src="http://localhost:5000/static-files/lib/notebook-trace-renderer/index.html?trace_id=c5d368d7011e416bb8a6a45fb5757cc5&amp;experiment_id=1&amp;trace_id=c838fe37a1554a709c48aa7d91df4051&amp;experiment_id=1&amp;trace_id=e3e3b12245c145609fbd9f2ea7a38b35&amp;experiment_id=1&amp;trace_id=f05d4d95db7d4aceb8b4158a8cf0cfb0&amp;experiment_id=1&amp;trace_id=e996a1553f3b4c7b97af98bc3665f7aa&amp;experiment_id=1&amp;trace_id=02d784d19b414f16bc36df2f6cace3af&amp;experiment_id=1&amp;trace_id=a4955baaaf944dbbadcd4f05cb1c10aa&amp;experiment_id=1&amp;trace_id=fcaf8824996d4c7eab4d03bd198f2c33&amp;experiment_id=1&amp;trace_id=73db052bdbe1418eb46bc6ec442df95e&amp;experiment_id=1&amp;trace_id=66a0910a43384a9f993773961116b241&amp;experiment_id=1&amp;version=3.1.4"
  />
</div>
</div>
</div>
<div id="cell-49" class="cell" data-execution_count="430">
<div class="sourceCode" id="cb393"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-3"><a href="#cb393-3" aria-hidden="true" tabindex="-1"></a>tdf <span class="op">=</span> pd.DataFrame(</span>
<span id="cb393-4"><a href="#cb393-4" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb393-5"><a href="#cb393-5" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&quot;LLM&quot;</span>: llms[idx].model, <span class="st">&quot;Evaluation Score&quot;</span>: candidate[<span class="dv">0</span>]}</span>
<span id="cb393-6"><a href="#cb393-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, candidate <span class="kw">in</span> <span class="bu">enumerate</span>(probe_results)</span>
<span id="cb393-7"><a href="#cb393-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb393-8"><a href="#cb393-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb393-9"><a href="#cb393-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tdf)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                  LLM  Evaluation Score
0           openai/gpt-4.1-2025-04-14              75.0
1      openai/gpt-4.1-mini-2025-04-14              65.0
2           openai/o4-mini-2025-04-16              78.5
3  anthropic/claude-sonnet-4-20250514              75.0
4             gemini/gemini-2.5-flash              74.0
5        gemini/gemini-2.5-flash-lite              64.0
6                openai/o3-2025-04-16              81.0
7    anthropic/claude-opus-4-20250514              80.0
8               gemini/gemini-2.5-pro              78.5</code></pre>
</div>
</div>
<p>From the above, we see that:</p>
<ul>
<li>Similar to the gate-only results, the <em>probe</em> dataset results should that OAI o3 performs the best, with 81% accuracy.</li>
<li>Anthropic Opus is a close second, with 80% accuracy. However, it is <strong>significantly</strong> more expensive, at $15/Million tokens üò±</li>
<li>Google‚Äôs Frontier model Gemini-pro is third, with 78% accuracy.</li>
<li>We see that the smaller reasoning models do quite well, with o4-mini getting around 78.5% accuracy, Anthropic sonnet-4 around 75% accuracy, and Google Gemini 2.5-flash at 74%. Note that, even here, Anthropic‚Äôs costs are significantly higher than the other models.</li>
<li>We also see that the ‚Äúmini/lite‚Äù version of models provided by Google and OAI have similar performance, around ~65%.</li>
</ul>
<p>Given the above insights, we can now select our models:</p>
<ul>
<li><strong>Anthropic Cost</strong>
<ul>
<li>All Anthropic models are significantly more expensive than the competitors, and have a performance on par or below the competetiors.</li>
<li>Hence, from our final list, we will exclude Anthropic models.</li>
</ul></li>
<li><strong>Frontier Model Cost</strong>
<ul>
<li>Frontier models are generally quite expensive.</li>
<li>From our tests, we see that OAI o3 has the best performace, with Google Gemini 2.5-pro having a performance on or below o3.</li>
<li>To save costs, we will keep only one frontier model in the final list i.e o3</li>
</ul></li>
<li><strong>Smaller Reasoning Models</strong>
<ul>
<li>We also see the following models showing promising results across the board:
<ul>
<li>o4-mini</li>
<li>gemini-2.5-flash</li>
</ul></li>
</ul></li>
<li><strong>Non reaosning models</strong>
<ul>
<li>GPT-4.1 seems to perform as well as the smaller reasoning models, but it is about 50% more expensive($2/Million input tokens).</li>
<li>Given that we already plan to include models with similar reasoning capabilities, we will exclude GPT-4.1 from our final list.</li>
</ul></li>
<li><strong>Small models</strong>
<ul>
<li>Currently, the small models variants of all models are significantly behind the larger models.</li>
<li>While they are cost effective, and likely their performance can be increased with improvements to the prompts, fine-tuning, etc., we will skip this models for now due to time constraits.</li>
</ul></li>
</ul>
<p>Hence, our final list of models will be:</p>
<ul>
<li>o3</li>
<li>o4-mini</li>
<li>gemini-2.5-flash</li>
</ul>
</section>
<section id="error-analysis" class="level3">
<h3>Error Analysis</h3>
<p>Given that we have the results for the gate and probe datasets, we can perform some quick preliminary error analysis to understand the performance of the models on these datasets.</p>
<p>We will restrict our analysis to the final list of models(o3, o4-mini and gemini-2.5-flash).</p>
<div id="cell-54" class="cell" data-execution_count="431">
<div class="sourceCode" id="cb395"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a>final_selected_models <span class="op">=</span> [</span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>    lm_oai_o4_mini,</span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a>    lm_gemini_flash_2_5,</span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a>    lm_oai_o3,</span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
</div>
<div id="cell-55" class="cell" data-execution_count="432">
<div class="sourceCode" id="cb396"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a>gate_and_probe_results <span class="op">=</span> results <span class="op">+</span> probe_results</span></code></pre></div>
</div>
<div id="cell-56" class="cell" data-execution_count="433">
<div class="sourceCode" id="cb397"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(gate_and_probe_results)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="433">
<pre><code>18</code></pre>
</div>
</div>
<div id="cell-57" class="cell" data-execution_count="437">
<div class="sourceCode" id="cb399"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a>selected_records <span class="op">=</span> []</span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, record <span class="kw">in</span> <span class="bu">enumerate</span>(gate_and_probe_results):</span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hack: Dirty hack to get results our selected LLMs. Sorry!</span></span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">15</span>]:</span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> example, prediction, score <span class="kw">in</span> record[<span class="dv">1</span>]:</span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true" tabindex="-1"></a>            model_idx <span class="op">=</span> idx <span class="cf">if</span> idx <span class="op">&lt;</span> <span class="dv">9</span> <span class="cf">else</span> idx <span class="op">-</span> <span class="dv">9</span></span>
<span id="cb399-7"><a href="#cb399-7" aria-hidden="true" tabindex="-1"></a>            example_copy <span class="op">=</span> deepcopy(example)</span>
<span id="cb399-8"><a href="#cb399-8" aria-hidden="true" tabindex="-1"></a>            example_copy[<span class="st">&quot;ground_truth_answer&quot;</span>] <span class="op">=</span> example_copy[<span class="st">&quot;answer&quot;</span>]</span>
<span id="cb399-9"><a href="#cb399-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">del</span> example_copy[<span class="st">&quot;answer&quot;</span>]</span>
<span id="cb399-10"><a href="#cb399-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb399-11"><a href="#cb399-11" aria-hidden="true" tabindex="-1"></a>            selected_records.append(</span>
<span id="cb399-12"><a href="#cb399-12" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb399-13"><a href="#cb399-13" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;model_name&quot;</span>: model_selection_llms[model_idx].model,</span>
<span id="cb399-14"><a href="#cb399-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;turn_em_metric_score&quot;</span>: score,</span>
<span id="cb399-15"><a href="#cb399-15" aria-hidden="true" tabindex="-1"></a>                    <span class="op">**</span>example_copy.toDict(),</span>
<span id="cb399-16"><a href="#cb399-16" aria-hidden="true" tabindex="-1"></a>                    <span class="op">**</span>prediction.toDict(),</span>
<span id="cb399-17"><a href="#cb399-17" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb399-18"><a href="#cb399-18" aria-hidden="true" tabindex="-1"></a>            )</span></code></pre></div>
</div>
<div id="cell-58" class="cell" data-execution_count="441">
<div class="sourceCode" id="cb400"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a>selected_records[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="441">
<pre><code>{&#39;model_name&#39;: &#39;openai/o4-mini-2025-04-16&#39;,
 &#39;turn_em_metric_score&#39;: 1.0,
 &#39;conversation_context&#39;: &#39;None&#39;,
 &#39;evidence_snippets&#39;: &quot;[PRE]\nentergy corporation and subsidiaries management&#39;s financial discussion and analysis refer to 201cselected financial data - five-year comparison of entergy corporation and subsidiaries 201d which accompanies entergy corporation 2019s financial statements in this report for further information with respect to operating statistics . in november 2007 the board approved a plan to pursue a separation of entergy 2019s non-utility nuclear business from entergy through a spin-off of the business to entergy shareholders . in april 2010 , entergy announced that it planned to unwind the business infrastructure associated with the proposed spin-off transaction . as a result of the plan to unwind the business infrastructure , entergy recorded expenses in 2010 for the write-off of certain capitalized costs incurred in connection with the planned spin-off transaction . these costs are discussed in more detail below and throughout this section . net revenue utility following is an analysis of the change in net revenue comparing 2010 to 2009 . amount ( in millions ) .\n[/PRE]\n[POST]\nthe volume/weather variance is primarily due to an increase of 8362 gwh , or 8% ( 8 % ) , in billed electricity usage in all retail sectors , including the effect on the residential sector of colder weather in the first quarter 2010 compared to 2009 and warmer weather in the second and third quarters 2010 compared to 2009 . the industrial sector reflected strong sales growth on continuing signs of economic recovery . the improvement in this sector was primarily driven by inventory restocking and strong exports with the chemicals , refining , and miscellaneous manufacturing sectors leading the improvement . the retail electric price variance is primarily due to : increases in the formula rate plan riders at entergy gulf states louisiana effective november 2009 , january 2010 , and september 2010 , at entergy louisiana effective november 2009 , and at entergy mississippi effective july 2009 ; a base rate increase at entergy arkansas effective july 2010 ; rate actions at entergy texas , including base rate increases effective in may and august 2010 ; a formula rate plan provision of $ 16.6 million recorded in the third quarter 2009 for refunds that were made to customers in accordance with settlements approved by the lpsc ; and the recovery in 2009 by entergy arkansas of 2008 extraordinary storm costs , as approved by the apsc , which ceased in january 2010 . the recovery of storm costs is offset in other operation and maintenance expenses . see note 2 to the financial statements for further discussion of the proceedings referred to above. .\n[/POST]&quot;,
 &#39;table&#39;: &#39;| Row | 2009 net revenue | volume/weather | retail electric price | provision for regulatory proceedings | rough production cost equalization | ano decommissioning trust | fuel recovery | other | 2010 net revenue |\n|---|---|---|---|---|---|---|---|---|---|\n| amount ( in millions ) | 4694.0 | 231.0 | 137.0 | 26.0 | 19.0 | -24.0 | -44.0 | 12.0 | 5051.0 |&#39;,
 &#39;question&#39;: &#39;what was the difference in net revenue between 2009 and 2010?&#39;,
 &#39;id&#39;: &#39;Single_ETR/2011/page_22.pdf-3&#39;,
 &#39;doc_pre_text&#39;: &quot;entergy corporation and subsidiaries management&#39;s financial discussion and analysis refer to 201cselected financial data - five-year comparison of entergy corporation and subsidiaries 201d which accompanies entergy corporation 2019s financial statements in this report for further information with respect to operating statistics . in november 2007 the board approved a plan to pursue a separation of entergy 2019s non-utility nuclear business from entergy through a spin-off of the business to entergy shareholders . in april 2010 , entergy announced that it planned to unwind the business infrastructure associated with the proposed spin-off transaction . as a result of the plan to unwind the business infrastructure , entergy recorded expenses in 2010 for the write-off of certain capitalized costs incurred in connection with the planned spin-off transaction . these costs are discussed in more detail below and throughout this section . net revenue utility following is an analysis of the change in net revenue comparing 2010 to 2009 . amount ( in millions ) .&quot;,
 &#39;doc_post_text&#39;: &#39;the volume/weather variance is primarily due to an increase of 8362 gwh , or 8% ( 8 % ) , in billed electricity usage in all retail sectors , including the effect on the residential sector of colder weather in the first quarter 2010 compared to 2009 and warmer weather in the second and third quarters 2010 compared to 2009 . the industrial sector reflected strong sales growth on continuing signs of economic recovery . the improvement in this sector was primarily driven by inventory restocking and strong exports with the chemicals , refining , and miscellaneous manufacturing sectors leading the improvement . the retail electric price variance is primarily due to : increases in the formula rate plan riders at entergy gulf states louisiana effective november 2009 , january 2010 , and september 2010 , at entergy louisiana effective november 2009 , and at entergy mississippi effective july 2009 ; a base rate increase at entergy arkansas effective july 2010 ; rate actions at entergy texas , including base rate increases effective in may and august 2010 ; a formula rate plan provision of $ 16.6 million recorded in the third quarter 2009 for refunds that were made to customers in accordance with settlements approved by the lpsc ; and the recovery in 2009 by entergy arkansas of 2008 extraordinary storm costs , as approved by the apsc , which ceased in january 2010 . the recovery of storm costs is offset in other operation and maintenance expenses . see note 2 to the financial statements for further discussion of the proceedings referred to above. .&#39;,
 &#39;doc_table&#39;: {&#39;amount ( in millions )&#39;: {&#39;2009 net revenue&#39;: 4694.0,
   &#39;volume/weather&#39;: 231.0,
   &#39;retail electric price&#39;: 137.0,
   &#39;provision for regulatory proceedings&#39;: 26.0,
   &#39;rough production cost equalization&#39;: 19.0,
   &#39;ano decommissioning trust&#39;: -24.0,
   &#39;fuel recovery&#39;: -44.0,
   &#39;other&#39;: 12.0,
   &#39;2010 net revenue&#39;: 5051.0}},
 &#39;dialogue_conv_questions&#39;: [&#39;what was the difference in net revenue between 2009 and 2010?&#39;,
  &#39;and the specific value for 2009 again?&#39;,
  &#39;so what was the percentage change during this time?&#39;],
 &#39;dialogue_conv_answers&#39;: [&#39;357&#39;, &#39;4694&#39;, &#39;7.61%&#39;],
 &#39;dialogue_turn_program&#39;: [&#39;subtract(5051, 4694)&#39;,
  &#39;4694&#39;,
  &#39;subtract(5051, 4694), divide(#0, 4694)&#39;],
 &#39;dialogue_executed_answers&#39;: [357.0, 4694.0, 0.07605],
 &#39;dialogue_qa_split&#39;: [False, False, False],
 &#39;features_num_dialogue_turns&#39;: 3,
 &#39;features_has_type2_question&#39;: False,
 &#39;features_has_duplicate_columns&#39;: False,
 &#39;features_has_non_numeric_values&#39;: False,
 &#39;ground_truth_answer&#39;: 357.0,
 &#39;reasoning&#39;: &#39;The table shows 2009 net revenue of 4,694.0 million and 2010 net revenue of 5,051.0 million. The difference is 5,051.0 minus 4,694.0, which equals 357.0 million.&#39;,
 &#39;ops&#39;: &#39;subtract(const_5051.0, const_4694.0)&#39;,
 &#39;answer&#39;: &#39;357.0&#39;}</code></pre>
</div>
</div>
<div id="cell-59" class="cell" data-execution_count="462">
<div class="sourceCode" id="cb402"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Literal</span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dspy</span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-5"><a href="#cb402-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AssessmentSignature(dspy.Signature):</span>
<span id="cb402-6"><a href="#cb402-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb402-7"><a href="#cb402-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Categorize model predictions by comparing them to ground truth, context, and evidence.</span></span>
<span id="cb402-8"><a href="#cb402-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Assign a specific error type or OK label, with concise justification, based on rubric.</span></span>
<span id="cb402-9"><a href="#cb402-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-10"><a href="#cb402-10" aria-hidden="true" tabindex="-1"></a><span class="co">    When comparing numerical answers, always allow a tolerance of 1e-2. For eg: If the question asks for a percentage, but the ground_truth_answer is given as a decimal, the assessment_answer label will be GROUND_TRUTH_INCORRECT</span></span>
<span id="cb402-11"><a href="#cb402-11" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb402-12"><a href="#cb402-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-13"><a href="#cb402-13" aria-hidden="true" tabindex="-1"></a>    ground_truth_answer: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(</span>
<span id="cb402-14"><a href="#cb402-14" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;The correct answer as per the ground truth data.&quot;</span></span>
<span id="cb402-15"><a href="#cb402-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb402-16"><a href="#cb402-16" aria-hidden="true" tabindex="-1"></a>    table: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(</span>
<span id="cb402-17"><a href="#cb402-17" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Tabular data (as string) relevant to the question and answer.&quot;</span></span>
<span id="cb402-18"><a href="#cb402-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb402-19"><a href="#cb402-19" aria-hidden="true" tabindex="-1"></a>    conversation_context: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(</span>
<span id="cb402-20"><a href="#cb402-20" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Previous dialogue turns or context for the current question.&quot;</span></span>
<span id="cb402-21"><a href="#cb402-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb402-22"><a href="#cb402-22" aria-hidden="true" tabindex="-1"></a>    evidence_snippets: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(</span>
<span id="cb402-23"><a href="#cb402-23" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Text snippets from the source document supporting the answer.&quot;</span></span>
<span id="cb402-24"><a href="#cb402-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb402-25"><a href="#cb402-25" aria-hidden="true" tabindex="-1"></a>    question: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(desc<span class="op">=</span><span class="st">&quot;The question being answered by the model.&quot;</span>)</span>
<span id="cb402-26"><a href="#cb402-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-27"><a href="#cb402-27" aria-hidden="true" tabindex="-1"></a>    predicted_reasoning: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(</span>
<span id="cb402-28"><a href="#cb402-28" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Model&#39;s step-by-step explanation or justification for its answer.&quot;</span></span>
<span id="cb402-29"><a href="#cb402-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb402-30"><a href="#cb402-30" aria-hidden="true" tabindex="-1"></a>    predicted_ops: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(</span>
<span id="cb402-31"><a href="#cb402-31" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;Operations or programmatic steps the model used to derive its answer.&quot;</span></span>
<span id="cb402-32"><a href="#cb402-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb402-33"><a href="#cb402-33" aria-hidden="true" tabindex="-1"></a>    predicted_answer: <span class="bu">str</span> <span class="op">=</span> dspy.InputField(</span>
<span id="cb402-34"><a href="#cb402-34" aria-hidden="true" tabindex="-1"></a>        desc<span class="op">=</span><span class="st">&quot;The answer predicted by the model for the given question.&quot;</span></span>
<span id="cb402-35"><a href="#cb402-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb402-36"><a href="#cb402-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-37"><a href="#cb402-37" aria-hidden="true" tabindex="-1"></a>    assessment_answer: Literal[</span>
<span id="cb402-38"><a href="#cb402-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;OK&quot;</span>,</span>
<span id="cb402-39"><a href="#cb402-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;NUMERICAL_ANSWER_WRONG&quot;</span>,</span>
<span id="cb402-40"><a href="#cb402-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;TEXTUAL_SELECTION_ANSWER_WRONG&quot;</span>,</span>
<span id="cb402-41"><a href="#cb402-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;FORMAT_ERROR&quot;</span>,</span>
<span id="cb402-42"><a href="#cb402-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;EVIDENCE_MISMATCH&quot;</span>,</span>
<span id="cb402-43"><a href="#cb402-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;GROUND_TRUTH_INCORRECT&quot;</span>,</span>
<span id="cb402-44"><a href="#cb402-44" aria-hidden="true" tabindex="-1"></a>    ] <span class="op">=</span> dspy.OutputField(desc<span class="op">=</span><span class="st">&quot;Single categorical label.&quot;</span>)</span></code></pre></div>
</div>
<div id="cell-60" class="cell" data-execution_count="468">
<div class="sourceCode" id="cb403"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a>selected_records[<span class="dv">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="468">
<pre><code>{&#39;model_name&#39;: &#39;openai/o4-mini-2025-04-16&#39;,
 &#39;turn_em_metric_score&#39;: 1.0,
 &#39;conversation_context&#39;: &#39;None&#39;,
 &#39;evidence_snippets&#39;: &quot;[PRE]\nentergy corporation and subsidiaries management&#39;s financial discussion and analysis refer to 201cselected financial data - five-year comparison of entergy corporation and subsidiaries 201d which accompanies entergy corporation 2019s financial statements in this report for further information with respect to operating statistics . in november 2007 the board approved a plan to pursue a separation of entergy 2019s non-utility nuclear business from entergy through a spin-off of the business to entergy shareholders . in april 2010 , entergy announced that it planned to unwind the business infrastructure associated with the proposed spin-off transaction . as a result of the plan to unwind the business infrastructure , entergy recorded expenses in 2010 for the write-off of certain capitalized costs incurred in connection with the planned spin-off transaction . these costs are discussed in more detail below and throughout this section . net revenue utility following is an analysis of the change in net revenue comparing 2010 to 2009 . amount ( in millions ) .\n[/PRE]\n[POST]\nthe volume/weather variance is primarily due to an increase of 8362 gwh , or 8% ( 8 % ) , in billed electricity usage in all retail sectors , including the effect on the residential sector of colder weather in the first quarter 2010 compared to 2009 and warmer weather in the second and third quarters 2010 compared to 2009 . the industrial sector reflected strong sales growth on continuing signs of economic recovery . the improvement in this sector was primarily driven by inventory restocking and strong exports with the chemicals , refining , and miscellaneous manufacturing sectors leading the improvement . the retail electric price variance is primarily due to : increases in the formula rate plan riders at entergy gulf states louisiana effective november 2009 , january 2010 , and september 2010 , at entergy louisiana effective november 2009 , and at entergy mississippi effective july 2009 ; a base rate increase at entergy arkansas effective july 2010 ; rate actions at entergy texas , including base rate increases effective in may and august 2010 ; a formula rate plan provision of $ 16.6 million recorded in the third quarter 2009 for refunds that were made to customers in accordance with settlements approved by the lpsc ; and the recovery in 2009 by entergy arkansas of 2008 extraordinary storm costs , as approved by the apsc , which ceased in january 2010 . the recovery of storm costs is offset in other operation and maintenance expenses . see note 2 to the financial statements for further discussion of the proceedings referred to above. .\n[/POST]&quot;,
 &#39;table&#39;: &#39;| Row | 2009 net revenue | volume/weather | retail electric price | provision for regulatory proceedings | rough production cost equalization | ano decommissioning trust | fuel recovery | other | 2010 net revenue |\n|---|---|---|---|---|---|---|---|---|---|\n| amount ( in millions ) | 4694.0 | 231.0 | 137.0 | 26.0 | 19.0 | -24.0 | -44.0 | 12.0 | 5051.0 |&#39;,
 &#39;question&#39;: &#39;what was the difference in net revenue between 2009 and 2010?&#39;,
 &#39;id&#39;: &#39;Single_ETR/2011/page_22.pdf-3&#39;,
 &#39;doc_pre_text&#39;: &quot;entergy corporation and subsidiaries management&#39;s financial discussion and analysis refer to 201cselected financial data - five-year comparison of entergy corporation and subsidiaries 201d which accompanies entergy corporation 2019s financial statements in this report for further information with respect to operating statistics . in november 2007 the board approved a plan to pursue a separation of entergy 2019s non-utility nuclear business from entergy through a spin-off of the business to entergy shareholders . in april 2010 , entergy announced that it planned to unwind the business infrastructure associated with the proposed spin-off transaction . as a result of the plan to unwind the business infrastructure , entergy recorded expenses in 2010 for the write-off of certain capitalized costs incurred in connection with the planned spin-off transaction . these costs are discussed in more detail below and throughout this section . net revenue utility following is an analysis of the change in net revenue comparing 2010 to 2009 . amount ( in millions ) .&quot;,
 &#39;doc_post_text&#39;: &#39;the volume/weather variance is primarily due to an increase of 8362 gwh , or 8% ( 8 % ) , in billed electricity usage in all retail sectors , including the effect on the residential sector of colder weather in the first quarter 2010 compared to 2009 and warmer weather in the second and third quarters 2010 compared to 2009 . the industrial sector reflected strong sales growth on continuing signs of economic recovery . the improvement in this sector was primarily driven by inventory restocking and strong exports with the chemicals , refining , and miscellaneous manufacturing sectors leading the improvement . the retail electric price variance is primarily due to : increases in the formula rate plan riders at entergy gulf states louisiana effective november 2009 , january 2010 , and september 2010 , at entergy louisiana effective november 2009 , and at entergy mississippi effective july 2009 ; a base rate increase at entergy arkansas effective july 2010 ; rate actions at entergy texas , including base rate increases effective in may and august 2010 ; a formula rate plan provision of $ 16.6 million recorded in the third quarter 2009 for refunds that were made to customers in accordance with settlements approved by the lpsc ; and the recovery in 2009 by entergy arkansas of 2008 extraordinary storm costs , as approved by the apsc , which ceased in january 2010 . the recovery of storm costs is offset in other operation and maintenance expenses . see note 2 to the financial statements for further discussion of the proceedings referred to above. .&#39;,
 &#39;doc_table&#39;: {&#39;amount ( in millions )&#39;: {&#39;2009 net revenue&#39;: 4694.0,
   &#39;volume/weather&#39;: 231.0,
   &#39;retail electric price&#39;: 137.0,
   &#39;provision for regulatory proceedings&#39;: 26.0,
   &#39;rough production cost equalization&#39;: 19.0,
   &#39;ano decommissioning trust&#39;: -24.0,
   &#39;fuel recovery&#39;: -44.0,
   &#39;other&#39;: 12.0,
   &#39;2010 net revenue&#39;: 5051.0}},
 &#39;dialogue_conv_questions&#39;: [&#39;what was the difference in net revenue between 2009 and 2010?&#39;,
  &#39;and the specific value for 2009 again?&#39;,
  &#39;so what was the percentage change during this time?&#39;],
 &#39;dialogue_conv_answers&#39;: [&#39;357&#39;, &#39;4694&#39;, &#39;7.61%&#39;],
 &#39;dialogue_turn_program&#39;: [&#39;subtract(5051, 4694)&#39;,
  &#39;4694&#39;,
  &#39;subtract(5051, 4694), divide(#0, 4694)&#39;],
 &#39;dialogue_executed_answers&#39;: [357.0, 4694.0, 0.07605],
 &#39;dialogue_qa_split&#39;: [False, False, False],
 &#39;features_num_dialogue_turns&#39;: 3,
 &#39;features_has_type2_question&#39;: False,
 &#39;features_has_duplicate_columns&#39;: False,
 &#39;features_has_non_numeric_values&#39;: False,
 &#39;ground_truth_answer&#39;: 357.0,
 &#39;reasoning&#39;: &#39;The table shows 2009 net revenue of 4,694.0 million and 2010 net revenue of 5,051.0 million. The difference is 5,051.0 minus 4,694.0, which equals 357.0 million.&#39;,
 &#39;ops&#39;: &#39;subtract(const_5051.0, const_4694.0)&#39;,
 &#39;answer&#39;: &#39;357.0&#39;}</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="469">
<div class="sourceCode" id="cb405"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a>judge_examples <span class="op">=</span> []</span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> record <span class="kw">in</span> selected_records:</span>
<span id="cb405-4"><a href="#cb405-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> record[<span class="st">&quot;turn_em_metric_score&quot;</span>] <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb405-5"><a href="#cb405-5" aria-hidden="true" tabindex="-1"></a>        judge_examples.append(</span>
<span id="cb405-6"><a href="#cb405-6" aria-hidden="true" tabindex="-1"></a>            dspy.Example(</span>
<span id="cb405-7"><a href="#cb405-7" aria-hidden="true" tabindex="-1"></a>                <span class="bu">id</span><span class="op">=</span>record[<span class="st">&quot;id&quot;</span>],</span>
<span id="cb405-8"><a href="#cb405-8" aria-hidden="true" tabindex="-1"></a>                model_name<span class="op">=</span>record[<span class="st">&quot;model_name&quot;</span>],</span>
<span id="cb405-9"><a href="#cb405-9" aria-hidden="true" tabindex="-1"></a>                predicted_reasoning<span class="op">=</span>record[<span class="st">&quot;reasoning&quot;</span>],</span>
<span id="cb405-10"><a href="#cb405-10" aria-hidden="true" tabindex="-1"></a>                predicted_ops<span class="op">=</span>record[<span class="st">&quot;ops&quot;</span>],</span>
<span id="cb405-11"><a href="#cb405-11" aria-hidden="true" tabindex="-1"></a>                predicted_answer<span class="op">=</span>record[<span class="st">&quot;answer&quot;</span>],</span>
<span id="cb405-12"><a href="#cb405-12" aria-hidden="true" tabindex="-1"></a>                ground_truth_answer<span class="op">=</span>record[<span class="st">&quot;ground_truth_answer&quot;</span>],</span>
<span id="cb405-13"><a href="#cb405-13" aria-hidden="true" tabindex="-1"></a>                table<span class="op">=</span>record[<span class="st">&quot;table&quot;</span>],</span>
<span id="cb405-14"><a href="#cb405-14" aria-hidden="true" tabindex="-1"></a>                conversation_context<span class="op">=</span>record[<span class="st">&quot;conversation_context&quot;</span>],</span>
<span id="cb405-15"><a href="#cb405-15" aria-hidden="true" tabindex="-1"></a>                evidence_snippets<span class="op">=</span>record[<span class="st">&quot;evidence_snippets&quot;</span>],</span>
<span id="cb405-16"><a href="#cb405-16" aria-hidden="true" tabindex="-1"></a>                question<span class="op">=</span>record[<span class="st">&quot;question&quot;</span>],</span>
<span id="cb405-17"><a href="#cb405-17" aria-hidden="true" tabindex="-1"></a>            ).with_inputs(</span>
<span id="cb405-18"><a href="#cb405-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;predicted_reasoning&quot;</span>,</span>
<span id="cb405-19"><a href="#cb405-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;predicted_ops&quot;</span>,</span>
<span id="cb405-20"><a href="#cb405-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;predicted_answer&quot;</span>,</span>
<span id="cb405-21"><a href="#cb405-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;ground_truth_answer&quot;</span>,</span>
<span id="cb405-22"><a href="#cb405-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;table&quot;</span>,</span>
<span id="cb405-23"><a href="#cb405-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;conversation_context&quot;</span>,</span>
<span id="cb405-24"><a href="#cb405-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;evidence_snippets&quot;</span>,</span>
<span id="cb405-25"><a href="#cb405-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;question&quot;</span>,</span>
<span id="cb405-26"><a href="#cb405-26" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb405-27"><a href="#cb405-27" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
</div>
<p>We‚Äôll use Gemini Flash 2.5 as our judge model, for classifying the generated predictions for error analysis</p>
<div id="cell-63" class="cell" data-execution_count="489">
<div class="sourceCode" id="cb406"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a>judge_lm <span class="op">=</span> deepcopy(lm_gemini_flash_2_5)</span>
<span id="cb406-4"><a href="#cb406-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-5"><a href="#cb406-5" aria-hidden="true" tabindex="-1"></a>judge_results <span class="op">=</span> []</span>
<span id="cb406-6"><a href="#cb406-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-7"><a href="#cb406-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> mlflow.start_run(run_name<span class="op">=</span><span class="st">&quot;error_analysis_gemini_2.5_flash&quot;</span>) <span class="im">as</span> run:</span>
<span id="cb406-8"><a href="#cb406-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> dspy.context(lm<span class="op">=</span>judge_lm, cache<span class="op">=</span><span class="va">True</span>, track_cost<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb406-9"><a href="#cb406-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> example <span class="kw">in</span> tqdm(judge_examples, desc<span class="op">=</span><span class="st">&quot;Judging examples&quot;</span>):</span>
<span id="cb406-10"><a href="#cb406-10" aria-hidden="true" tabindex="-1"></a>            module <span class="op">=</span> dspy.ChainOfThought(AssessmentSignature)</span>
<span id="cb406-11"><a href="#cb406-11" aria-hidden="true" tabindex="-1"></a>            jr <span class="op">=</span> module(<span class="op">**</span>example)</span>
<span id="cb406-12"><a href="#cb406-12" aria-hidden="true" tabindex="-1"></a>            jr[<span class="st">&quot;assessment_reasoning&quot;</span>] <span class="op">=</span> jr[<span class="st">&quot;reasoning&quot;</span>]</span>
<span id="cb406-13"><a href="#cb406-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">del</span> jr[<span class="st">&quot;reasoning&quot;</span>]</span>
<span id="cb406-14"><a href="#cb406-14" aria-hidden="true" tabindex="-1"></a>            judge_results.append(</span>
<span id="cb406-15"><a href="#cb406-15" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb406-16"><a href="#cb406-16" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;id&quot;</span>: example[<span class="st">&quot;id&quot;</span>],</span>
<span id="cb406-17"><a href="#cb406-17" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;model_name&quot;</span>: example[<span class="st">&quot;model_name&quot;</span>],</span>
<span id="cb406-18"><a href="#cb406-18" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;question&quot;</span>: example[<span class="st">&quot;question&quot;</span>],</span>
<span id="cb406-19"><a href="#cb406-19" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;ground_truth_answer&quot;</span>: example[<span class="st">&quot;ground_truth_answer&quot;</span>],</span>
<span id="cb406-20"><a href="#cb406-20" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;predicted_answer&quot;</span>: example[<span class="st">&quot;predicted_answer&quot;</span>],</span>
<span id="cb406-21"><a href="#cb406-21" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;assessment_answer&quot;</span>: jr[<span class="st">&quot;assessment_answer&quot;</span>],</span>
<span id="cb406-22"><a href="#cb406-22" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;assessment_reasoning&quot;</span>: jr[<span class="st">&quot;assessment_reasoning&quot;</span>],</span>
<span id="cb406-23"><a href="#cb406-23" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb406-24"><a href="#cb406-24" aria-hidden="true" tabindex="-1"></a>            )</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Judging examples:   1%|          | 2/289 [00:00&lt;00:17, 16.77it/s]2025/07/28 20:07:50 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:   1%|‚ñè         | 4/289 [00:00&lt;00:19, 14.79it/s]2025/07/28 20:07:50 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:   2%|‚ñè         | 6/289 [00:00&lt;00:19, 14.85it/s]2025/07/28 20:07:50 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:50 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:   4%|‚ñç         | 11/289 [00:00&lt;00:22, 12.42it/s]2025/07/28 20:07:51 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:   5%|‚ñç         | 14/289 [00:00&lt;00:18, 15.05it/s]2025/07/28 20:07:51 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:51 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:   6%|‚ñå         | 17/289 [00:01&lt;00:15, 18.13it/s]2025/07/28 20:07:51 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:51 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:   7%|‚ñã         | 20/289 [00:01&lt;00:13, 19.77it/s]2025/07/28 20:07:51 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:   8%|‚ñä         | 24/289 [00:01&lt;00:11, 23.48it/s]2025/07/28 20:07:51 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  10%|‚ñâ         | 28/289 [00:01&lt;00:09, 26.52it/s]2025/07/28 20:07:51 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  11%|‚ñà         | 32/289 [00:01&lt;00:09, 27.24it/s]2025/07/28 20:07:51 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  12%|‚ñà‚ñè        | 35/289 [00:01&lt;00:10, 23.43it/s]2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  13%|‚ñà‚ñé        | 38/289 [00:01&lt;00:10, 23.92it/s]2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  14%|‚ñà‚ñç        | 41/289 [00:01&lt;00:10, 23.64it/s]2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  15%|‚ñà‚ñå        | 44/289 [00:02&lt;00:10, 24.06it/s]2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  16%|‚ñà‚ñã        | 47/289 [00:02&lt;00:09, 24.36it/s]2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  17%|‚ñà‚ñã        | 50/289 [00:02&lt;00:09, 24.44it/s]2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  18%|‚ñà‚ñä        | 53/289 [00:02&lt;00:10, 23.14it/s]2025/07/28 20:07:52 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  20%|‚ñà‚ñà        | 59/289 [00:02&lt;00:11, 20.29it/s]2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  21%|‚ñà‚ñà‚ñè       | 62/289 [00:03&lt;00:13, 16.86it/s]2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  22%|‚ñà‚ñà‚ñè       | 65/289 [00:03&lt;00:11, 19.32it/s]2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  24%|‚ñà‚ñà‚ñé       | 68/289 [00:03&lt;00:10, 20.77it/s]2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  25%|‚ñà‚ñà‚ñç       | 71/289 [00:03&lt;00:09, 22.32it/s]2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  26%|‚ñà‚ñà‚ñå       | 74/289 [00:03&lt;00:09, 22.84it/s]2025/07/28 20:07:53 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  27%|‚ñà‚ñà‚ñã       | 77/289 [00:03&lt;00:09, 22.32it/s]2025/07/28 20:07:54 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  28%|‚ñà‚ñà‚ñä       | 80/289 [00:03&lt;00:10, 20.68it/s]2025/07/28 20:07:54 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  30%|‚ñà‚ñà‚ñâ       | 86/289 [00:04&lt;00:09, 21.69it/s]2025/07/28 20:07:54 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:54 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:54 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  31%|‚ñà‚ñà‚ñà       | 89/289 [00:04&lt;00:09, 21.10it/s]2025/07/28 20:07:54 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  32%|‚ñà‚ñà‚ñà‚ñè      | 92/289 [00:04&lt;00:09, 21.50it/s]2025/07/28 20:07:54 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:54 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  33%|‚ñà‚ñà‚ñà‚ñé      | 95/289 [00:04&lt;00:08, 22.81it/s]2025/07/28 20:07:54 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  34%|‚ñà‚ñà‚ñà‚ñç      | 98/289 [00:04&lt;00:07, 23.91it/s]2025/07/28 20:07:55 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  35%|‚ñà‚ñà‚ñà‚ñç      | 101/289 [00:04&lt;00:07, 24.41it/s]2025/07/28 20:07:55 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:55 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  36%|‚ñà‚ñà‚ñà‚ñå      | 104/289 [00:04&lt;00:08, 20.70it/s]2025/07/28 20:07:55 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:55 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  37%|‚ñà‚ñà‚ñà‚ñã      | 107/289 [00:05&lt;00:11, 16.11it/s]2025/07/28 20:07:55 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  38%|‚ñà‚ñà‚ñà‚ñä      | 110/289 [00:05&lt;00:09, 18.39it/s]2025/07/28 20:07:55 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:55 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  39%|‚ñà‚ñà‚ñà‚ñâ      | 114/289 [00:05&lt;00:08, 21.66it/s]2025/07/28 20:07:55 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:55 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:55 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  41%|‚ñà‚ñà‚ñà‚ñà      | 118/289 [00:05&lt;00:07, 24.12it/s]2025/07/28 20:07:56 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:56 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 122/289 [00:05&lt;00:06, 25.92it/s]2025/07/28 20:07:56 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 128/289 [00:05&lt;00:06, 23.89it/s]2025/07/28 20:07:56 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:56 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 131/289 [00:06&lt;00:06, 22.85it/s]2025/07/28 20:07:56 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  46%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 134/289 [00:06&lt;00:06, 23.46it/s]2025/07/28 20:07:56 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 137/289 [00:06&lt;00:06, 23.90it/s]2025/07/28 20:07:56 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:56 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 140/289 [00:06&lt;00:06, 23.84it/s]2025/07/28 20:07:56 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 149/289 [00:06&lt;00:05, 24.60it/s]2025/07/28 20:07:57 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:57 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:57 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 155/289 [00:07&lt;00:06, 22.09it/s]2025/07/28 20:07:57 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:57 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:57 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 158/289 [00:07&lt;00:07, 18.30it/s]2025/07/28 20:07:57 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:57 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 161/289 [00:07&lt;00:06, 19.50it/s]2025/07/28 20:07:57 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:57 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 164/289 [00:07&lt;00:05, 21.21it/s]2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 168/289 [00:07&lt;00:05, 23.87it/s]2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 172/289 [00:07&lt;00:04, 25.66it/s]2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 175/289 [00:07&lt;00:04, 26.17it/s]2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 178/289 [00:08&lt;00:05, 20.48it/s]2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 181/289 [00:08&lt;00:05, 19.97it/s]2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 184/289 [00:08&lt;00:04, 21.03it/s]2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:58 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 187/289 [00:08&lt;00:04, 21.89it/s]2025/07/28 20:07:59 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:59 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:59 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 190/289 [00:08&lt;00:04, 20.94it/s]2025/07/28 20:07:59 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 193/289 [00:08&lt;00:04, 21.33it/s]2025/07/28 20:07:59 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 196/289 [00:09&lt;00:04, 21.37it/s]2025/07/28 20:07:59 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:07:59 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 199/289 [00:09&lt;00:05, 17.97it/s]2025/07/28 20:07:59 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 201/289 [00:09&lt;00:05, 16.87it/s]2025/07/28 20:07:59 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 203/289 [00:09&lt;00:05, 14.73it/s]2025/07/28 20:08:00 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:00 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 206/289 [00:09&lt;00:04, 17.68it/s]2025/07/28 20:08:00 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 213/289 [00:09&lt;00:03, 23.63it/s]2025/07/28 20:08:00 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 216/289 [00:10&lt;00:02, 24.77it/s]2025/07/28 20:08:00 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 219/289 [00:10&lt;00:02, 25.95it/s]2025/07/28 20:08:00 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:00 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 222/289 [00:10&lt;00:02, 22.83it/s]2025/07/28 20:08:00 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:00 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 225/289 [00:10&lt;00:03, 19.59it/s]2025/07/28 20:08:00 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:00 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:01 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 228/289 [00:10&lt;00:03, 19.79it/s]2025/07/28 20:08:01 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 231/289 [00:10&lt;00:02, 20.88it/s]2025/07/28 20:08:01 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 234/289 [00:10&lt;00:02, 22.36it/s]2025/07/28 20:08:01 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 237/289 [00:11&lt;00:02, 22.83it/s]2025/07/28 20:08:01 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:01 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:01 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 240/289 [00:11&lt;00:02, 22.23it/s]2025/07/28 20:08:01 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:01 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 243/289 [00:11&lt;00:02, 21.50it/s]2025/07/28 20:08:01 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:01 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 246/289 [00:11&lt;00:02, 14.67it/s]2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 249/289 [00:11&lt;00:02, 16.99it/s]2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 252/289 [00:11&lt;00:01, 19.29it/s]2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 256/289 [00:12&lt;00:01, 22.46it/s]2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 260/289 [00:12&lt;00:01, 24.88it/s]2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 263/289 [00:12&lt;00:01, 24.21it/s]2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 266/289 [00:12&lt;00:00, 25.37it/s]2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:02 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 269/289 [00:12&lt;00:00, 20.30it/s]2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 272/289 [00:12&lt;00:00, 19.67it/s]2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 275/289 [00:12&lt;00:00, 20.71it/s]2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 278/289 [00:13&lt;00:00, 21.31it/s]2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 281/289 [00:13&lt;00:00, 22.55it/s]2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 284/289 [00:13&lt;00:00, 22.90it/s]2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples:  99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 287/289 [00:13&lt;00:00, 23.65it/s]2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
2025/07/28 20:08:03 WARNING dspy.adapters.json_adapter: Failed to use structured output format, falling back to JSON mode.
Judging examples: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 289/289 [00:13&lt;00:00, 21.43it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>üèÉ View run error_analysis_gemini_2.5_flash at: http://localhost:5000/#/experiments/1/runs/d415524ddcf94cd086f2f221c2f6f177
üß™ View experiment at: http://localhost:5000/#/experiments/1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">

<div>
  <style scoped>
  button {
    border: none;
    border-radius: 4px;
    background-color: rgb(34, 114, 180);
    font-family: -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial;
    font-size: 13px;
    color: white;
    margin-top: 8px;
    margin-bottom: 8px;
    padding: 8px 16px;
    cursor: pointer;
  }
  button:hover {
    background-color: rgb(66, 153, 224);
  }
  </style>
  <button
    onclick="
        const display = this.nextElementSibling.style.display;
        const isCollapsed = display === 'none';
        this.nextElementSibling.style.display = isCollapsed ? null : 'none';

        const verb = isCollapsed ? 'Collapse' : 'Expand';
        this.innerText = `${verb} MLflow Trace`;
    "
  >Collapse MLflow Trace</button>
  <iframe
    id="trace-renderer"
    style="width: 100%; height: 500px; border: none; resize: vertical;"
    src="http://localhost:5000/static-files/lib/notebook-trace-renderer/index.html?trace_id=f51ec31b099c4ccb884824cd84faf244&amp;experiment_id=1&amp;trace_id=2b2a5bac43db4bdf8f1ba27a0c72707f&amp;experiment_id=1&amp;trace_id=33d30ce093eb4bcb8959b7e7b14f4f03&amp;experiment_id=1&amp;trace_id=585d29108d074c8eb2546d615be4e058&amp;experiment_id=1&amp;trace_id=f458046f22604e4cbb206f2ddea55891&amp;experiment_id=1&amp;trace_id=fae282bd8d524323a37fbafd71e5e50f&amp;experiment_id=1&amp;trace_id=e0f8503464d846308c8ac03dd3897e1a&amp;experiment_id=1&amp;trace_id=2f17ef3a251a4472920aac663506297b&amp;experiment_id=1&amp;trace_id=cb93f2fdd18b4a1289219be14632eeb9&amp;experiment_id=1&amp;trace_id=29a36ca6d3bb4720860417319bbe8d68&amp;experiment_id=1&amp;version=3.1.4"
  />
</div>
</div>
</div>
<div id="cell-64" class="cell" data-execution_count="490">
<div class="sourceCode" id="cb410"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb410-3"><a href="#cb410-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-4"><a href="#cb410-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(judge_results)</span>
<span id="cb410-5"><a href="#cb410-5" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> (</span>
<span id="cb410-6"><a href="#cb410-6" aria-hidden="true" tabindex="-1"></a>    df.groupby([<span class="st">&quot;model_name&quot;</span>, <span class="st">&quot;assessment_answer&quot;</span>]).size().reset_index(name<span class="op">=</span><span class="st">&quot;count&quot;</span>)</span>
<span id="cb410-7"><a href="#cb410-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb410-8"><a href="#cb410-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb410-9"><a href="#cb410-9" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.barplot(data<span class="op">=</span>grouped, x<span class="op">=</span><span class="st">&quot;model_name&quot;</span>, y<span class="op">=</span><span class="st">&quot;count&quot;</span>, hue<span class="op">=</span><span class="st">&quot;assessment_answer&quot;</span>)</span>
<span id="cb410-10"><a href="#cb410-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Assessment Answer Counts by Model&quot;</span>)</span>
<span id="cb410-11"><a href="#cb410-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Count&quot;</span>)</span>
<span id="cb410-12"><a href="#cb410-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Model Name&quot;</span>)</span>
<span id="cb410-13"><a href="#cb410-13" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&quot;Assessment Answer&quot;</span>)</span>
<span id="cb410-14"><a href="#cb410-14" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb410-15"><a href="#cb410-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-16"><a href="#cb410-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add value annotations</span></span>
<span id="cb410-17"><a href="#cb410-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> ax.patches:</span>
<span id="cb410-18"><a href="#cb410-18" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> p.get_height()</span>
<span id="cb410-19"><a href="#cb410-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> height <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb410-20"><a href="#cb410-20" aria-hidden="true" tabindex="-1"></a>        ax.annotate(</span>
<span id="cb410-21"><a href="#cb410-21" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;</span><span class="sc">{</span><span class="bu">int</span>(height)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb410-22"><a href="#cb410-22" aria-hidden="true" tabindex="-1"></a>            (p.get_x() <span class="op">+</span> p.get_width() <span class="op">/</span> <span class="dv">2</span>, height),</span>
<span id="cb410-23"><a href="#cb410-23" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">&quot;center&quot;</span>,</span>
<span id="cb410-24"><a href="#cb410-24" aria-hidden="true" tabindex="-1"></a>            va<span class="op">=</span><span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb410-25"><a href="#cb410-25" aria-hidden="true" tabindex="-1"></a>            fontsize<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb410-26"><a href="#cb410-26" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb410-27"><a href="#cb410-27" aria-hidden="true" tabindex="-1"></a>            xytext<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb410-28"><a href="#cb410-28" aria-hidden="true" tabindex="-1"></a>            textcoords<span class="op">=</span><span class="st">&quot;offset points&quot;</span>,</span>
<span id="cb410-29"><a href="#cb410-29" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb410-30"><a href="#cb410-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-31"><a href="#cb410-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><a href="2025-09-01-cl-dspy-modelling_files/figure-html/cell-40-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="2025-09-01-cl-dspy-modelling_files/figure-html/cell-40-output-1.png" class="img-fluid" /></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-65" class="cell" data-execution_count="502">
<div class="sourceCode" id="cb411"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">&#39;./judge_results/gate_and_probe_judge_results.csv&#39;</span>, index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
</div>
<p>From the analysis above, we see that: - Majority of the errors for all our selected models are due to <strong>incorrect ground truth</strong>. - We also see cases where the model was unable to generate the answer in the format as expected by the ground truth. - Finally, somewhat surpringly, we see some results marked as ‚ÄúOK‚Äù, even though we only selected records that didn‚Äôt match the ground truth using our <em>exact match</em> metric.</p>
<p>Let‚Äôs look through this more closely:</p>
<div id="cell-67" class="cell" data-execution_count="503">
<div class="sourceCode" id="cb412"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">&quot;assessment_answer&quot;</span>] <span class="op">==</span> <span class="st">&quot;GROUND_TRUTH_INCORRECT&quot;</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="503">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">model_name</th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">ground_truth_answer</th>
<th data-quarto-table-cell-role="th">predicted_answer</th>
<th data-quarto-table-cell-role="th">assessment_answer</th>
<th data-quarto-table-cell-role="th">assessment_reasoning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Single_ETR/2011/page_22.pdf-3</td>
<td>openai/o4-mini-2025-04-16</td>
<td>so what was the percentage change during this time?</td>
<td>7.605000e-02</td>
<td>7.6%</td>
<td>GROUND_TRUTH_INCORRECT</td>
<td>The question asks for a "percentage change". The model correctly c...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Single_ETR/2004/page_258.pdf-4</td>
<td>openai/o4-mini-2025-04-16</td>
<td>what is the percent change?</td>
<td>1.473800e-01</td>
<td>14.7%</td>
<td>GROUND_TRUTH_INCORRECT</td>
<td>The question asks for the "percent change". The predicted answer p...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Single_ADI/2011/page_83.pdf-2</td>
<td>openai/o4-mini-2025-04-16</td>
<td>what growth rate does this represent?</td>
<td>8.290600e-01</td>
<td>82.9%</td>
<td>GROUND_TRUTH_INCORRECT</td>
<td>The question asks for a 'growth rate', which is typically expresse...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Single_CB/2008/page_243.pdf-3</td>
<td>openai/o4-mini-2025-04-16</td>
<td>what was the percent change?</td>
<td>7.368000e-02</td>
<td>7.37</td>
<td>GROUND_TRUTH_INCORRECT</td>
<td>The question asks for the "percent change". The model correctly ca...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>Single_AMT/2015/page_50.pdf-1</td>
<td>openai/o4-mini-2025-04-16</td>
<td>what was the low for share price for the quarter ended 12/31/15?</td>
<td>8.732000e+01</td>
<td>90.2</td>
<td>GROUND_TRUTH_INCORRECT</td>
<td>The question asks for the low share price for the quarter ended 12...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">282</td>
<td>Single_SLG/2017/page_114.pdf-3</td>
<td>openai/o3-2025-04-16</td>
<td>so what was the percentage of pension plan contributions out of th...</td>
<td>2.302800e-01</td>
<td>23.03</td>
<td>GROUND_TRUTH_INCORRECT</td>
<td>The question asks for a "percentage". The model correctly calculat...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">283</td>
<td>Single_JPM/2008/page_177.pdf-4</td>
<td>openai/o3-2025-04-16</td>
<td>what was the total amount of resale agreements in 2008, in millions?</td>
<td>2.080000e+04</td>
<td>200,265</td>
<td>GROUND_TRUTH_INCORRECT</td>
<td>The question asks for the 'total amount of resale agreements in 20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">284</td>
<td>Double_IPG/2014/page_95.pdf</td>
<td>openai/o3-2025-04-16</td>
<td>and what is it for the the 2009 one?</td>
<td>1.218121e+07</td>
<td>435259</td>
<td>GROUND_TRUTH_INCORRECT</td>
<td>The question asks for the value for "the 2009 one". The previous t...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">286</td>
<td>Single_APTV/2018/page_36.pdf-2</td>
<td>openai/o3-2025-04-16</td>
<td>how much does the change in the value of the aptiv plc represent i...</td>
<td>3.080000e-01</td>
<td>30.8%</td>
<td>GROUND_TRUTH_INCORRECT</td>
<td>The question asks for the answer "in percentage". The model correc...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">288</td>
<td>Single_RCL/2016/page_7.pdf-3</td>
<td>openai/o3-2025-04-16</td>
<td>what percentage change does this represent?</td>
<td>1.600000e-01</td>
<td>16.0</td>
<td>GROUND_TRUTH_INCORRECT</td>
<td>The question asks for a 'percentage change'. The model correctly c...</td>
</tr>
</tbody>
</table>

<p>226 rows √ó 7 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Curriculum-first pass surfaced a gap between our metric and reality. Several ‚Äúerrors‚Äù are actually correct answers hidden by formatting. Manual review shows many EM misses are due to surface form, not reasoning.</p>
<p>There are also cases where the ground-truth in the dataset is incorrect.</p>
<p><strong>What broke EM</strong></p>
<ul>
<li>Numeric formatting: thousands separators, ‚Äú0.5M‚Äù vs ‚Äú500000‚Äù.</li>
<li>Units and scaling: $, %, M/B suffixes; percent vs decimal.</li>
<li>Rounding/tolerance: 2dp rounding vs full precision.</li>
<li>Boolean variants: yes/true/1 vs no/false/0.</li>
</ul>
<p>The above results are <strong>not conclusive</strong> by any means, since the LLM-as-a-judge approach also has known flaws. However, it does give us some pointers on how to improve the model performance from here!</p>
<p><strong>Note</strong>: LLM-as-judge remains imperfect. We‚Äôll retain periodic human spot-checks. With cleaner metrics and logging, the next step is to test if DSPy‚Äôs optimizers actually lift EM under the Easy‚ÜíMedium‚ÜíHard schedule without inflating token cost.</p>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyLXRpdGxl">Shubham Gupta</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1uYXZiYXItdGl0bGU=">Shubham Gupta</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1uYXZiYXI6QWJvdXQ=">About</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1uYXZiYXI6L2Fib3V0Lmh0bWw=">/about.html</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1uYXZiYXI6aHR0cHM6Ly9naXRodWIuY29tL2dvb2RoYW1ndXB0YQ==">https://github.com/goodhamgupta</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1uYXZiYXI6L2luZGV4LnhtbA==">/index.xml</span></p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLW1ldGF0aXRsZQ==">Curriculum Learning ü§ù DSPy: Modelling ‚Äì Shubham Gupta</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLXR3aXR0ZXJjYXJkdGl0bGU=">Curriculum Learning ü§ù DSPy: Modelling ‚Äì Shubham Gupta</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLW9nY2FyZHRpdGxl">Curriculum Learning ü§ù DSPy: Modelling ‚Äì Shubham Gupta</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLW1ldGFzaXRlbmFtZQ==">Shubham Gupta</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLXR3aXR0ZXJjYXJkZGVzYw==">Mapping ConvFinQA and crafting a curriculum for financial QA</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLW9nY2FyZGRkZXNj">Mapping ConvFinQA and crafting a curriculum for financial QA</span></p>
</div>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/shubhamg\.in");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      if (authorPrefersDark) {
          [baseTheme, altTheme] = [altTheme, baseTheme];
      }
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "goodhamgupta/personal_blog";
    script.dataset.repoId = "R_kgDOLXv-xA";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOLXv-xM4Cdogy";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>

</body>

</html>
</iframe></div></div></div></section></main></div><footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/goodhamgupta/personal_blog/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>